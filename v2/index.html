<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‰∫∫ÊùêËÇ≤Êàê„Ç∑„Éü„É•„É¨„Éº„Çø„Éº v2</title>
    <!-- React and ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel for JSX compilation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Chart.js for visualizations -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Recharts for React charts -->
    <script src="https://unpkg.com/recharts@2.8.0/umd/Recharts.js"></script>
    
    <style>
        body {
            font-family: 'Hiragino Sans', 'Yu Gothic', sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .title {
            font-size: 2.5em;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.2em;
            color: #7f8c8d;
            margin-bottom: 20px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid #e9ecef;
        }
        
        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .stat-label {
            color: #7f8c8d;
            margin-top: 5px;
            font-size: 0.9em;
        }
        
        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 30px;
            margin: 40px 0;
        }
        
        .control-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            border: 2px solid #e9ecef;
        }
        
        .control-section h3 {
            margin-top: 0;
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        
        .slider-container {
            margin: 15px 0;
        }
        
        .slider-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            color: #2c3e50;
            font-weight: 500;
        }
        
        .slider {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: #e9ecef;
            outline: none;
            -webkit-appearance: none;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #3498db;
            cursor: pointer;
        }
        
        .chart-container {
            margin: 30px 0;
            height: 500px;
            background: white;
            border-radius: 15px;
            padding: 20px;
            border: 2px solid #e9ecef;
        }
        
        .individuals-section {
            margin: 40px 0;
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            border: 2px solid #e9ecef;
        }
        
        .individuals-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .individual-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #e9ecef;
            transition: transform 0.2s ease;
        }
        
        .individual-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .individual-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .individual-name {
            font-weight: bold;
            color: #2c3e50;
            font-size: 1.1em;
        }
        
        .individual-age {
            background: #3498db;
            color: white;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.8em;
        }
        
        .individual-info {
            margin-bottom: 15px;
        }
        
        .individual-role {
            color: #7f8c8d;
            font-size: 0.9em;
        }
        
        .individual-tenure {
            color: #27ae60;
            font-size: 0.8em;
            margin-top: 3px;
        }
        
        .skills-mini-chart {
            margin-top: 10px;
        }
        
        .skill-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 3px 0;
            font-size: 0.7em;
        }
        
        .skill-name {
            min-width: 60px;
            color: #7f8c8d;
        }
        
        .skill-progress {
            flex-grow: 1;
            height: 4px;
            background: #e9ecef;
            border-radius: 2px;
            margin: 0 8px;
            overflow: hidden;
        }
        
        .skill-fill {
            height: 100%;
            background: #3498db;
            transition: width 0.3s ease;
        }
        
        .skill-value {
            min-width: 25px;
            text-align: right;
            color: #2c3e50;
            font-weight: 500;
        }
        
        .succession-indicator {
            background: #f39c12;
            color: white;
            padding: 2px 6px;
            border-radius: 8px;
            font-size: 0.7em;
            margin-top: 5px;
            display: inline-block;
        }
        
        .buttons {
            text-align: center;
            margin: 30px 0;
        }
        
        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            margin: 10px;
            font-size: 1em;
            font-weight: 500;
            transition: background 0.3s ease;
        }
        
        button:hover {
            background: #2980b9;
        }
        
        .event-log {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            max-height: 200px;
            overflow-y: auto;
            border: 2px solid #e9ecef;
        }
        
        .event-item {
            padding: 8px;
            margin: 5px 0;
            background: white;
            border-radius: 5px;
            font-size: 0.9em;
            border-left: 4px solid #3498db;
        }
        
        .retirement-event {
            border-left-color: #e74c3c;
        }
        
        .graduation-event {
            border-left-color: #27ae60;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;
        const { RadarChart, PolarGrid, PolarAngleAxis, PolarRadiusAxis, Radar, Legend, ResponsiveContainer, LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, BarChart, Bar } = Recharts;

        // ËÉΩÂäõËª∏„ÅÆÂÆöÁæ©Ôºà11Ëª∏Ôºâ
        const CAPABILITY_AXES = [
            { key: 'basicScience', name: 'Âü∫Á§éÁßëÂ≠¶', color: '#8884d8' },
            { key: 'appliedTech', name: 'ÂøúÁî®ÊäÄË°ì', color: '#82ca9d' },
            { key: 'digitalAI', name: '„Éá„Ç∏„Çø„É´„ÉªAI', color: '#ffc658' },
            { key: 'manufacturing', name: 'Ë£ΩÈÄ†„Éª„ÇÇ„ÅÆ„Å•„Åè„Çä', color: '#ff7300' },
            { key: 'finance', name: 'ÈáëËûç„ÉªÁµåÊ∏à', color: '#00C49F' },
            { key: 'energy', name: '„Ç®„Éç„É´„ÇÆ„Éº„ÉªÁí∞Â¢É', color: '#FF8042' },
            { key: 'globalCompete', name: 'ÂõΩÈöõÁ´∂‰∫âÂäõ', color: '#0088FE' },
            { key: 'innovation', name: '„Ç§„Éé„Éô„Éº„Ç∑„Éß„É≥', color: '#00C49F' },
            { key: 'education', name: 'ÊïôËÇ≤Âü∫Áõ§', color: '#FFBB28' },
            { key: 'policyMaking', name: 'ÊîøÁ≠ñÁ´ãÊ°à', color: '#FF8042' },
            { key: 'implementation', name: 'Á§æ‰ºöÂÆüË£ÖÂäõ', color: '#8884d8' },
            { key: 'succession', name: 'ÊäÄË°ìÁ∂ôÊâøÊÄß', color: '#9333ea' },
        ];

        // „Çª„ÇØ„Çø„ÉºÂà•Âú®Á±çÊúüÈñì
        const SECTOR_TENURE = {
            university_professor: { name: 'Â§ßÂ≠¶ÊïôÊéà', min: 30, max: 40, avg: 35 },
            university_student_bachelor: { name: 'Â≠¶ÈÉ®Áîü', min: 3, max: 4, avg: 4 },
            university_student_master: { name: '‰øÆÂ£´', min: 1, max: 2, avg: 2 },
            university_student_doctor: { name: 'ÂçöÂ£´', min: 3, max: 5, avg: 3 },
            industry_engineer: { name: 'Áî£Ê•≠Áïå„Ç®„É≥„Ç∏„Éã„Ç¢', min: 3, max: 5, avg: 4 },
            government_official: { name: 'ÊîøÁïå„ÉªÂÆòÂÉö', min: 2, max: 3, avg: 3 },
            researcher: { name: 'Â§ñÈÉ®Á†îÁ©∂ËÄÖ', min: 5, max: 10, avg: 7 },
        };

        // ÂÄã‰∫∫„Éó„É≠„Éï„Ç°„Ç§„É´‰ΩúÊàê
        const createIndividual = (id, name, sector, role, age, tenure, skills) => ({
            id,
            name,
            sector,
            role,
            age,
            tenure,
            maxTenure: SECTOR_TENURE[role]?.avg || 5,
            skills: { ...skills },
            mentoring: 0,
            successorCount: 0,
        });

        // ÂàùÊúüÂÄã‰∫∫„Éá„Éº„Çø
        const initialIndividuals = [
            // Â§ßÂ≠¶„Çª„ÇØ„Çø„Éº
            createIndividual(1, 'Â±±Áî∞ÊïôÊéà', 'university', 'university_professor', 55, 25, {
                basicScience: 90, appliedTech: 60, digitalAI: 40, manufacturing: 30,
                finance: 20, energy: 50, globalCompete: 70, innovation: 65,
                education: 85, policyMaking: 40, implementation: 35, succession: 80,
            }),
            createIndividual(2, 'Èà¥Êú®Âä©Êïô', 'university', 'university_professor', 35, 5, {
                basicScience: 70, appliedTech: 55, digitalAI: 65, manufacturing: 25,
                finance: 15, energy: 40, globalCompete: 50, innovation: 60,
                education: 50, policyMaking: 20, implementation: 30, succession: 40,
            }),
            createIndividual(3, 'Áî∞‰∏≠Ôºà‰øÆÂ£´Ôºâ', 'university', 'university_student_master', 24, 1, {
                basicScience: 45, appliedTech: 35, digitalAI: 50, manufacturing: 20,
                finance: 10, energy: 25, globalCompete: 30, innovation: 40,
                education: 15, policyMaking: 5, implementation: 15, succession: 10,
            }),
            // Áî£Ê•≠Áïå„Çª„ÇØ„Çø„Éº
            createIndividual(4, '‰ΩêËó§ÔºàËã•ÊâãSEÔºâ', 'industry', 'industry_engineer', 26, 2, {
                basicScience: 30, appliedTech: 55, digitalAI: 70, manufacturing: 40,
                finance: 25, energy: 20, globalCompete: 35, innovation: 45,
                education: 10, policyMaking: 5, implementation: 60, succession: 15,
            }),
            createIndividual(5, 'È´òÊ©ãÔºà„Ç∑„Éã„Ç¢EngÔºâ', 'industry', 'industry_engineer', 45, 4, {
                basicScience: 40, appliedTech: 85, digitalAI: 60, manufacturing: 80,
                finance: 35, energy: 45, globalCompete: 50, innovation: 55,
                education: 30, policyMaking: 25, implementation: 85, succession: 70,
            }),
            createIndividual(6, '‰ºäËó§Ôºà‰∏≠Â†ÖÔºâ', 'industry', 'industry_engineer', 35, 3, {
                basicScience: 35, appliedTech: 70, digitalAI: 75, manufacturing: 55,
                finance: 30, energy: 30, globalCompete: 40, innovation: 50,
                education: 20, policyMaking: 15, implementation: 70, succession: 35,
            }),
            // ÊîøÂ∫ú„Çª„ÇØ„Çø„Éº
            createIndividual(7, 'Ê∏°Ëæ∫ÔºàÂÆòÂÉöÔºâ', 'government', 'government_official', 40, 2, {
                basicScience: 25, appliedTech: 30, digitalAI: 35, manufacturing: 20,
                finance: 70, energy: 55, globalCompete: 45, innovation: 30,
                education: 25, policyMaking: 80, implementation: 60, succession: 25,
            }),
        ];

        // ÂõΩÂäõË®àÁÆó
        const calculateNationalCapability = (individuals) => {
            const capability = {};
            CAPABILITY_AXES.forEach(axis => {
                const values = individuals.map(ind => ind.skills[axis.key] || 0);
                const sum = values.reduce((a, b) => a + Math.pow(b, 0.8), 0);
                const ces = Math.pow(sum, 1/0.8) / individuals.length;
                const min = Math.min(...values);
                capability[axis.key] = ces * 0.7 + min * 0.3;
            });
            return capability;
        };

        // ÊäÄË°ìÁ∂ôÊâøÊÄß„Çπ„Ç≥„Ç¢Ë®àÁÆó
        const calculateSuccessionScore = (individuals) => {
            let score = 0;
            const sectors = ['university', 'industry', 'government'];
            
            sectors.forEach(sector => {
                const sectorPeople = individuals.filter(i => i.sector === sector);
                if (sectorPeople.length === 0) return;
                
                const ages = sectorPeople.map(p => p.age);
                const ageRange = Math.max(...ages) - Math.min(...ages);
                const ageScore = Math.min(40, ageRange) / 40 * 30;
                
                const tenureMargin = sectorPeople.reduce((sum, p) => {
                    return sum + Math.max(0, p.maxTenure - p.tenure) / p.maxTenure;
                }, 0) / sectorPeople.length;
                const tenureScore = tenureMargin * 40;
                
                const highSkillCount = sectorPeople.filter(p => 
                    Object.values(p.skills).reduce((a,b) => a+b, 0) / CAPABILITY_AXES.length > 50
                ).length;
                const mentorScore = (highSkillCount / sectorPeople.length) * 30;
                
                score += (ageScore + tenureScore + mentorScore) / 3;
            });
            
            return score / sectors.length;
        };

        function TalentDevelopmentSimulatorV2() {
            const [year, setYear] = useState(0);
            const [individuals, setIndividuals] = useState(initialIndividuals);
            const [capability, setCapability] = useState(() => calculateNationalCapability(initialIndividuals));
            const [events, setEvents] = useState([]);
            const [investments, setInvestments] = useState({
                university: 30,
                industry: 35,
                government: 15,
                research: 20,
            });

            // „Çπ„Ç≥„Ç¢Ë®àÁÆó
            const calculateScore = useCallback((cap) => {
                const values = Object.values(cap);
                const avg = values.reduce((a, b) => a + b, 0) / values.length;
                const min = Math.min(...values);
                return Math.round(avg * 0.6 + min * 0.4);
            }, []);

            // 1Âπ¥ÂàÜ„ÅÆ„Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥
            const simulateYear = useCallback(() => {
                setIndividuals(prev => {
                    const newIndividuals = [...prev];
                    const newEvents = [];

                    // Âπ¥ÈΩ¢„Å®Âú®Á±çÂπ¥Êï∞„ÅÆÊõ¥Êñ∞
                    newIndividuals.forEach(person => {
                        person.age++;
                        person.tenure++;
                    });

                    // ÈÄÄËÅ∑„ÉªÂçíÊ•≠Âá¶ÁêÜ
                    const remainingIndividuals = newIndividuals.filter(person => {
                        if (person.tenure >= person.maxTenure) {
                            newEvents.push({
                                type: person.role.includes('student') ? 'graduation' : 'retirement',
                                message: `${person.name}„Åå${person.role.includes('student') ? 'ÂçíÊ•≠' : 'ÈÄÄËÅ∑'}„Åó„Åæ„Åó„Åü (${person.age}Ê≠≥)`
                            });
                            return false;
                        }
                        return true;
                    });

                    // Êñ∞Ë¶è‰∫∫Êùê„ÅÆËøΩÂä†ÔºàÁ∞°Âçò„Å™‰æãÔºâ
                    const newRecruits = Math.floor(Math.random() * 3);
                    for (let i = 0; i < newRecruits; i++) {
                        const sectors = ['university', 'industry', 'government'];
                        const randomSector = sectors[Math.floor(Math.random() * sectors.length)];
                        const roles = {
                            university: ['university_student_master', 'university_student_doctor'],
                            industry: ['industry_engineer'],
                            government: ['government_official']
                        };
                        const randomRole = roles[randomSector][Math.floor(Math.random() * roles[randomSector].length)];
                        
                        // „É©„É≥„ÉÄ„É†„Çπ„Ç≠„É´ÁîüÊàê
                        const randomSkills = {};
                        CAPABILITY_AXES.forEach(axis => {
                            randomSkills[axis.key] = Math.floor(Math.random() * 60) + 20;
                        });

                        remainingIndividuals.push(createIndividual(
                            Date.now() + i,
                            `Êñ∞‰∫∫${Date.now() + i}`,
                            randomSector,
                            randomRole,
                            22 + Math.floor(Math.random() * 8),
                            0,
                            randomSkills
                        ));

                        newEvents.push({
                            type: 'recruitment',
                            message: `Êñ∞‰∫∫${Date.now() + i}„Åå${randomSector}„Å´ÂèÇÂä†„Åó„Åæ„Åó„Åü`
                        });
                    }

                    setEvents(prev => [...newEvents, ...prev].slice(0, 20));
                    return remainingIndividuals;
                });

                setYear(prev => prev + 1);
            }, []);

            // ÂõΩÂäõ„ÅÆÊõ¥Êñ∞
            useEffect(() => {
                setCapability(calculateNationalCapability(individuals));
            }, [individuals]);

            return (
                <div className="container">
                    <div className="header">
                        <h1 className="title">üåè ÂõΩÂÆ∂‰∫∫ÊùêËÇ≤Êàê„Ç∑„Éü„É•„É¨„Éº„Çø„Éº v2</h1>
                        <p className="subtitle">Individual Profile Tracking & Succession Analysis</p>
                        <p>Âπ¥Â∫¶: {year}Âπ¥ÁõÆ | ‰∫∫ÊùêÁ∑èÊï∞: {individuals.length}Âêç</p>
                    </div>

                    <div className="stats-grid">
                        <div className="stat-card">
                            <div className="stat-value">{calculateScore(capability)}</div>
                            <div className="stat-label">Á∑èÂêàÂõΩÂäõ„Çπ„Ç≥„Ç¢</div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-value">{individuals.length}</div>
                            <div className="stat-label">Á∑è‰∫∫ÊùêÊï∞</div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-value">{calculateSuccessionScore(individuals).toFixed(1)}</div>
                            <div className="stat-label">ÊäÄË°ìÁ∂ôÊâøÊÄß</div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-value">{individuals.filter(p => p.sector === 'industry').length}</div>
                            <div className="stat-label">Áî£Ê•≠Áïå‰∫∫Êùê</div>
                        </div>
                    </div>

                    <div className="controls">
                        <div className="control-section">
                            <h3>üí∞ ÊäïË≥áÈÖçÂàÜ</h3>
                            {Object.entries(investments).map(([key, value]) => (
                                <div key={key} className="slider-container">
                                    <div className="slider-label">
                                        <span>{key === 'university' ? 'üéì Â§ßÂ≠¶' : 
                                               key === 'industry' ? 'üè≠ Áî£Ê•≠' : 
                                               key === 'government' ? 'üèõÔ∏è ÊîøÂ∫ú' : 'üî¨ Á†îÁ©∂'}</span>
                                        <span>{value}%</span>
                                    </div>
                                    <input
                                        type="range"
                                        className="slider"
                                        min="0"
                                        max="100"
                                        value={value}
                                        onChange={(e) => setInvestments(prev => ({
                                            ...prev,
                                            [key]: parseInt(e.target.value)
                                        }))}
                                    />
                                </div>
                            ))}
                        </div>
                    </div>

                    <div className="buttons">
                        <button onClick={simulateYear}>1Âπ¥ÈÄ≤„ÇÅ„Çã</button>
                        <button onClick={() => {
                            setYear(0);
                            setIndividuals(initialIndividuals);
                            setEvents([]);
                        }}>
                            „É™„Çª„ÉÉ„Éà
                        </button>
                    </div>

                    <div className="chart-container">
                        <ResponsiveContainer width="100%" height={400}>
                            <RadarChart data={CAPABILITY_AXES.map(axis => ({
                                name: axis.name,
                                current: capability[axis.key] || 0,
                                target: 80
                            }))}>
                                <PolarGrid />
                                <PolarAngleAxis dataKey="name" />
                                <PolarRadiusAxis angle={0} domain={[0, 100]} />
                                <Radar name="ÁèæÂú®" dataKey="current" stroke="#8884d8" fill="#8884d8" fillOpacity={0.3} />
                                <Radar name="ÁõÆÊ®ô" dataKey="target" stroke="#82ca9d" fill="#82ca9d" fillOpacity={0.1} />
                                <Legend />
                            </RadarChart>
                        </ResponsiveContainer>
                    </div>

                    <div className="event-log">
                        <h4>üìÖ „Ç§„Éô„É≥„Éà„É≠„Ç∞</h4>
                        {events.map((event, index) => (
                            <div key={index} className={`event-item ${event.type}-event`}>
                                {event.message}
                            </div>
                        ))}
                    </div>

                    <div className="individuals-section">
                        <h3>üë• ÂÄã‰∫∫„Éó„É≠„Éï„Ç°„Ç§„É´ ({individuals.length}Âêç)</h3>
                        <div className="individuals-grid">
                            {individuals.map(person => (
                                <div key={person.id} className="individual-card">
                                    <div className="individual-header">
                                        <div className="individual-name">{person.name}</div>
                                        <div className="individual-age">{person.age}Ê≠≥</div>
                                    </div>
                                    <div className="individual-info">
                                        <div className="individual-role">{SECTOR_TENURE[person.role]?.name || person.role}</div>
                                        <div className="individual-tenure">
                                            Âú®Á±ç: {person.tenure}/{person.maxTenure}Âπ¥
                                        </div>
                                        <div className="succession-indicator">
                                            Á∂ôÊâøÊÄß: {person.skills.succession}
                                        </div>
                                    </div>
                                    <div className="skills-mini-chart">
                                        {CAPABILITY_AXES.slice(0, 6).map(axis => (
                                            <div key={axis.key} className="skill-bar">
                                                <div className="skill-name">{axis.name.slice(0, 3)}</div>
                                                <div className="skill-progress">
                                                    <div 
                                                        className="skill-fill"
                                                        style={{width: `${person.skills[axis.key]}%`}}
                                                    />
                                                </div>
                                                <div className="skill-value">{person.skills[axis.key]}</div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<TalentDevelopmentSimulatorV2 />, document.getElementById('root'));
    </script>
</body>
</html>