<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äººæè‚²æˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ v2</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Hiragino Sans', 'Yu Gothic', sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .control-group {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
        }
        
        .control-group h3 {
            margin-top: 0;
            color: #2c3e50;
        }
        
        .slider {
            width: 100%;
            margin: 10px 0;
        }
        
        .chart-container {
            margin: 20px 0;
            height: 400px;
            position: relative;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: #f1f2f6;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .stat-label {
            color: #7f8c8d;
            margin-top: 5px;
        }
        
        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        
        button:hover {
            background: #2980b9;
        }
        
        .year-display {
            text-align: center;
            font-size: 1.5em;
            margin: 20px 0;
            color: #2c3e50;
        }
        
        .individual-tracker {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .individual-list {
            max-height: 300px;
            overflow-y: auto;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
        }
        
        .individual-card {
            background: white;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ddd;
            font-size: 0.9em;
        }
        
        .individual-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .individual-sector {
            color: #7f8c8d;
            font-size: 0.8em;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect } = React;

        // èƒ½åŠ›è»¸ã®å®šç¾©
        const CAPABILITY_AXES = [
            { key: 'basicScience', name: 'åŸºç¤ç§‘å­¦' },
            { key: 'appliedTech', name: 'å¿œç”¨æŠ€è¡“' },
            { key: 'digitalAI', name: 'ãƒ‡ã‚¸ã‚¿ãƒ«ãƒ»AI' },
            { key: 'manufacturing', name: 'è£½é€ ãƒ»ã‚‚ã®ã¥ãã‚Š' },
            { key: 'finance', name: 'é‡‘èãƒ»çµŒæ¸ˆ' },
            { key: 'healthcare', name: 'åŒ»ç™‚ãƒ»ãƒ˜ãƒ«ã‚¹ã‚±ã‚¢' },
            { key: 'energy', name: 'ã‚¨ãƒãƒ«ã‚®ãƒ¼ãƒ»ç’°å¢ƒ' },
            { key: 'globalCompete', name: 'å›½éš›ç«¶äº‰åŠ›' },
            { key: 'innovation', name: 'ã‚¤ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³' },
            { key: 'education', name: 'æ•™è‚²åŸºç›¤' },
            { key: 'policyMaking', name: 'æ”¿ç­–ç«‹æ¡ˆ' },
            { key: 'implementation', name: 'ç¤¾ä¼šå®Ÿè£…åŠ›' }
        ];

        // ã‚»ã‚¯ã‚¿ãƒ¼å®šç¾©
        const SECTORS = ['university', 'industry', 'government', 'research'];
        const SECTOR_NAMES = {
            'university': 'å¤§å­¦',
            'industry': 'ç”£æ¥­ç•Œ',
            'government': 'æ”¿åºœ',
            'research': 'ç ”ç©¶æ©Ÿé–¢'
        };

        // åˆæœŸå›½åŠ›çŠ¶æ…‹
        const initialNationalCapability = {
            basicScience: 70,
            appliedTech: 65,
            digitalAI: 55,
            manufacturing: 75,
            finance: 60,
            healthcare: 70,
            energy: 50,
            globalCompete: 45,
            innovation: 50,
            education: 65,
            policyMaking: 55,
            implementation: 60,
        };

        function TalentDevelopmentSimulatorV2() {
            const [year, setYear] = useState(0);
            const [capability, setCapability] = useState({...initialNationalCapability});
            const [investments, setInvestments] = useState({
                university: 30,
                industry: 35,
                government: 15,
                research: 20,
            });
            
            const [talentAllocation, setTalentAllocation] = useState({
                toIndustry: 50,
                toGovernment: 20,
                toResearch: 30,
            });
            
            const [individuals, setIndividuals] = useState([]);
            const [chart, setChart] = useState(null);

            // å€‹äººãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ
            const generateIndividual = (id, sector) => {
                const strengths = [];
                const numStrengths = Math.floor(Math.random() * 3) + 1;
                
                for (let i = 0; i < numStrengths; i++) {
                    const randomAxis = CAPABILITY_AXES[Math.floor(Math.random() * CAPABILITY_AXES.length)];
                    if (!strengths.includes(randomAxis.key)) {
                        strengths.push(randomAxis.key);
                    }
                }
                
                return {
                    id,
                    name: `äººæ${id}`,
                    sector,
                    strengths,
                    yearsInSector: 0,
                    totalContribution: 0
                };
            };

            // ã‚¹ã‚³ã‚¢è¨ˆç®—
            function calculateScore(cap) {
                const values = Object.values(cap);
                const avg = values.reduce((a, b) => a + b, 0) / values.length;
                const min = Math.min(...values);
                return Math.round(avg * 0.6 + min * 0.4);
            }

            // 1å¹´åˆ†ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
            const simulateYear = () => {
                setCapability(prev => {
                    const newCap = {...prev};
                    
                    // å¤§å­¦æŠ•è³‡åŠ¹æœ
                    const uniEffect = investments.university / 100;
                    newCap.basicScience += uniEffect * 3;
                    newCap.education += uniEffect * 2;
                    newCap.innovation += uniEffect * 1.5;
                    
                    // ç”£æ¥­ç•ŒæŠ•è³‡åŠ¹æœ
                    const indEffect = investments.industry / 100;
                    newCap.appliedTech += indEffect * 3;
                    newCap.manufacturing += indEffect * 2.5;
                    newCap.digitalAI += indEffect * 2;
                    newCap.implementation += indEffect * 2;
                    
                    // æ”¿åºœæŠ•è³‡åŠ¹æœ
                    const govEffect = investments.government / 100;
                    newCap.policyMaking += govEffect * 3;
                    newCap.finance += govEffect * 2;
                    
                    // ç ”ç©¶æŠ•è³‡åŠ¹æœ
                    const resEffect = investments.research / 100;
                    newCap.globalCompete += resEffect * 3;
                    newCap.healthcare += resEffect * 2;
                    newCap.energy += resEffect * 2;
                    
                    // å€‹äººã‹ã‚‰ã®è²¢çŒ®åŠ¹æœ
                    individuals.forEach(person => {
                        person.strengths.forEach(strength => {
                            newCap[strength] += 0.5 * (person.yearsInSector + 1) / 10;
                        });
                    });
                    
                    // ä¸Šé™ã‚’100ã«åˆ¶é™
                    Object.keys(newCap).forEach(key => {
                        newCap[key] = Math.min(100, newCap[key]);
                    });
                    
                    return newCap;
                });
                
                // å€‹äººãƒ‡ãƒ¼ã‚¿æ›´æ–°
                setIndividuals(prev => {
                    let newIndividuals = [...prev];
                    
                    // æ—¢å­˜äººæã®å¹´æ•°å¢—åŠ 
                    newIndividuals = newIndividuals.map(person => ({
                        ...person,
                        yearsInSector: person.yearsInSector + 1
                    }));
                    
                    // æ–°è¦äººæè¿½åŠ ï¼ˆå¤§å­¦ã‹ã‚‰å„ã‚»ã‚¯ã‚¿ãƒ¼ã¸ï¼‰
                    const newGraduates = Math.floor((investments.university / 10) * 2);
                    for (let i = 0; i < newGraduates; i++) {
                        let targetSector = 'industry';
                        const rand = Math.random() * 100;
                        if (rand < talentAllocation.toResearch) {
                            targetSector = 'research';
                        } else if (rand < talentAllocation.toResearch + talentAllocation.toGovernment) {
                            targetSector = 'government';
                        }
                        
                        newIndividuals.push(generateIndividual(
                            Date.now() + i + Math.random(),
                            targetSector
                        ));
                    }
                    
                    // äººæ•°åˆ¶é™ï¼ˆæœ€æ–°1000äººã¾ã§ï¼‰
                    if (newIndividuals.length > 1000) {
                        newIndividuals = newIndividuals.slice(-1000);
                    }
                    
                    return newIndividuals;
                });
                
                setYear(prev => prev + 1);
            };

            // ãƒ¬ãƒ¼ãƒ€ãƒ¼ãƒãƒ£ãƒ¼ãƒˆæ›´æ–°
            useEffect(() => {
                const ctx = document.getElementById('radarChart');
                if (ctx) {
                    if (chart) {
                        chart.destroy();
                    }

                    const data = {
                        labels: CAPABILITY_AXES.map(axis => axis.name),
                        datasets: [{
                            label: 'ç¾åœ¨ã®å›½åŠ›',
                            data: CAPABILITY_AXES.map(axis => capability[axis.key]),
                            backgroundColor: 'rgba(54, 162, 235, 0.2)',
                            borderColor: 'rgba(54, 162, 235, 1)',
                            pointBackgroundColor: 'rgba(54, 162, 235, 1)',
                        }]
                    };

                    const newChart = new Chart(ctx, {
                        type: 'radar',
                        data: data,
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                r: {
                                    beginAtZero: true,
                                    max: 100,
                                    ticks: {
                                        stepSize: 20
                                    }
                                }
                            }
                        }
                    });
                    setChart(newChart);
                }
            }, [capability]);

            return (
                <div className="container">
                    <h1 style={{textAlign: 'center', color: '#2c3e50'}}>ğŸŒ å›½å®¶äººæè‚²æˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ v2</h1>
                    <p style={{textAlign: 'center', color: '#7f8c8d'}}>å€‹äººãƒ¢ãƒ‡ãƒ«è¿½è·¡ãƒ»æŠ€è¡“ç¶™æ‰¿æ€§æŒ‡æ¨™</p>
                    
                    <div className="year-display">
                        å¹´åº¦: {year}å¹´ç›®
                    </div>

                    <div className="stats">
                        <div className="stat-card">
                            <div className="stat-value">{calculateScore(capability)}</div>
                            <div className="stat-label">ç·åˆå›½åŠ›ã‚¹ã‚³ã‚¢</div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-value">{individuals.length}</div>
                            <div className="stat-label">äººæç·æ•°</div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-value">{individuals.filter(p => p.sector === 'industry').length}</div>
                            <div className="stat-label">ç”£æ¥­ç•Œäººæ</div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-value">{Math.min(...Object.values(capability)).toFixed(0)}</div>
                            <div className="stat-label">æœ€å¼±è»¸ã‚¹ã‚³ã‚¢</div>
                        </div>
                    </div>

                    <div className="controls">
                        <div className="control-group">
                            <h3>æŠ•è³‡é…åˆ†</h3>
                            <div>
                                ğŸ“ å¤§å­¦æŠ•è³‡: {investments.university}%
                                <input 
                                    type="range" 
                                    className="slider"
                                    min="0" max="100" 
                                    value={investments.university}
                                    onChange={(e) => setInvestments(prev => ({...prev, university: parseInt(e.target.value)}))}
                                />
                            </div>
                            <div>
                                ğŸ­ ç”£æ¥­æŠ•è³‡: {investments.industry}%
                                <input 
                                    type="range" 
                                    className="slider"
                                    min="0" max="100" 
                                    value={investments.industry}
                                    onChange={(e) => setInvestments(prev => ({...prev, industry: parseInt(e.target.value)}))}
                                />
                            </div>
                        </div>
                        
                        <div className="control-group">
                            <h3>äººæé…åˆ†ï¼ˆå¤§å­¦ã‹ã‚‰ã®è¼©å‡ºå…ˆï¼‰</h3>
                            <div>
                                ğŸ­ ç”£æ¥­ç•Œ: {talentAllocation.toIndustry}%
                                <input 
                                    type="range" 
                                    className="slider"
                                    min="0" max="100" 
                                    value={talentAllocation.toIndustry}
                                    onChange={(e) => setTalentAllocation(prev => ({...prev, toIndustry: parseInt(e.target.value)}))}
                                />
                            </div>
                            <div>
                                ğŸ›ï¸ æ”¿åºœ: {talentAllocation.toGovernment}%
                                <input 
                                    type="range" 
                                    className="slider"
                                    min="0" max="100" 
                                    value={talentAllocation.toGovernment}
                                    onChange={(e) => setTalentAllocation(prev => ({...prev, toGovernment: parseInt(e.target.value)}))}
                                />
                            </div>
                            <div>
                                ğŸ”¬ ç ”ç©¶æ©Ÿé–¢: {talentAllocation.toResearch}%
                                <input 
                                    type="range" 
                                    className="slider"
                                    min="0" max="100" 
                                    value={talentAllocation.toResearch}
                                    onChange={(e) => setTalentAllocation(prev => ({...prev, toResearch: parseInt(e.target.value)}))}
                                />
                            </div>
                        </div>
                    </div>

                    <div style={{textAlign: 'center', margin: '20px 0'}}>
                        <button onClick={simulateYear}>1å¹´é€²ã‚ã‚‹</button>
                        <button onClick={() => {
                            setCapability({...initialNationalCapability});
                            setYear(0);
                            setIndividuals([]);
                        }}>
                            ãƒªã‚»ãƒƒãƒˆ
                        </button>
                    </div>

                    <div className="chart-container">
                        <canvas id="radarChart"></canvas>
                    </div>

                    <div className="individual-tracker">
                        <h3>äººæè¿½è·¡ (æœ€æ–°50å)</h3>
                        <div className="individual-list">
                            {individuals.slice(-50).map(person => (
                                <div key={person.id} className="individual-card">
                                    <div className="individual-name">{person.name}</div>
                                    <div className="individual-sector">{SECTOR_NAMES[person.sector]} ({person.yearsInSector}å¹´ç›®)</div>
                                    <div style={{fontSize: '0.7em', marginTop: '3px'}}>
                                        å°‚é–€: {person.strengths.slice(0,2).map(s => CAPABILITY_AXES.find(a => a.key === s)?.name.slice(0,4)).join(', ')}
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<TalentDevelopmentSimulatorV2 />, document.getElementById('root'));
    </script>
</body>
</html>