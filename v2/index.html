<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äººæè‚²æˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ v2</title>
    
    <!-- React and ReactDOM CDN -->
    <script crossorigin src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    
    <!-- Babel Standalone for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Recharts -->
    <script src="https://unpkg.com/recharts@2.8.0/umd/Recharts.js"></script>
    
    <style>
        body {
            font-family: 'Hiragino Sans', 'Yu Gothic', sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid #e9ecef;
        }
        
        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .stat-label {
            color: #6c757d;
            margin-top: 5px;
        }
        
        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .control-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #e9ecef;
        }
        
        .control-section h3 {
            margin-top: 0;
            color: #2c3e50;
        }
        
        .slider-container {
            margin: 15px 0;
        }
        
        .slider-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            color: #2c3e50;
        }
        
        .slider {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #ddd;
            outline: none;
        }
        
        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px;
            font-size: 1em;
        }
        
        button:hover {
            background: #2980b9;
        }
        
        .chart-container {
            margin: 30px 0;
            height: 400px;
            background: white;
            border-radius: 10px;
            padding: 20px;
            border: 2px solid #e9ecef;
        }
        
        .individuals {
            margin: 30px 0;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #e9ecef;
        }
        
        .individual-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .individual-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #ddd;
        }
        
        .individual-name {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        
        .individual-info {
            font-size: 0.9em;
            color: #6c757d;
        }
        
        .buttons {
            text-align: center;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;
        const { RadarChart, PolarGrid, PolarAngleAxis, PolarRadiusAxis, Radar, Legend, ResponsiveContainer } = window.Recharts || {};

        // èƒ½åŠ›è»¸ã®å®šç¾©
        const CAPABILITY_AXES = [
            { key: 'basicScience', name: 'åŸºç¤ç§‘å­¦', color: '#8884d8' },
            { key: 'appliedTech', name: 'å¿œç”¨æŠ€è¡“', color: '#82ca9d' },
            { key: 'digitalAI', name: 'ãƒ‡ã‚¸ã‚¿ãƒ«ãƒ»AI', color: '#ffc658' },
            { key: 'manufacturing', name: 'è£½é€ ãƒ»ã‚‚ã®ã¥ãã‚Š', color: '#ff7300' },
            { key: 'finance', name: 'é‡‘èãƒ»çµŒæ¸ˆ', color: '#00C49F' },
            { key: 'energy', name: 'ã‚¨ãƒãƒ«ã‚®ãƒ¼ãƒ»ç’°å¢ƒ', color: '#FF8042' },
            { key: 'globalCompete', name: 'å›½éš›ç«¶äº‰åŠ›', color: '#0088FE' },
            { key: 'innovation', name: 'ã‚¤ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³', color: '#00C49F' },
            { key: 'education', name: 'æ•™è‚²åŸºç›¤', color: '#FFBB28' },
            { key: 'policyMaking', name: 'æ”¿ç­–ç«‹æ¡ˆ', color: '#FF8042' },
            { key: 'implementation', name: 'ç¤¾ä¼šå®Ÿè£…åŠ›', color: '#8884d8' },
            { key: 'succession', name: 'æŠ€è¡“ç¶™æ‰¿æ€§', color: '#9333ea' },
        ];

        // ã‚»ã‚¯ã‚¿ãƒ¼åˆ¥åœ¨ç±æœŸé–“
        const SECTOR_TENURE = {
            university_professor: { name: 'å¤§å­¦æ•™æˆ', min: 30, max: 40, avg: 35 },
            university_student_bachelor: { name: 'å­¦éƒ¨ç”Ÿ', min: 3, max: 4, avg: 4 },
            university_student_master: { name: 'ä¿®å£«', min: 1, max: 2, avg: 2 },
            university_student_doctor: { name: 'åšå£«', min: 3, max: 5, avg: 3 },
            industry_engineer: { name: 'ç”£æ¥­ç•Œã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢', min: 3, max: 5, avg: 4 },
            government_official: { name: 'æ”¿ç•Œãƒ»å®˜åƒš', min: 2, max: 3, avg: 3 },
            researcher: { name: 'å¤–éƒ¨ç ”ç©¶è€…', min: 5, max: 10, avg: 7 },
        };

        // å€‹äººãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ
        const createIndividual = (id, name, sector, role, age, tenure, skills) => ({
            id,
            name,
            sector,
            role,
            age,
            tenure,
            maxTenure: SECTOR_TENURE[role]?.avg || 5,
            skills: { ...skills },
            mentoring: 0,
            successorCount: 0,
        });

        // åˆæœŸå€‹äººãƒ‡ãƒ¼ã‚¿
        const initialIndividuals = [
            createIndividual(1, 'å±±ç”°æ•™æˆ', 'university', 'university_professor', 55, 25, {
                basicScience: 90, appliedTech: 60, digitalAI: 40, manufacturing: 30,
                finance: 20, energy: 50, globalCompete: 70, innovation: 65,
                education: 85, policyMaking: 40, implementation: 35, succession: 80,
            }),
            createIndividual(2, 'éˆ´æœ¨åŠ©æ•™', 'university', 'university_professor', 35, 5, {
                basicScience: 70, appliedTech: 55, digitalAI: 65, manufacturing: 25,
                finance: 15, energy: 40, globalCompete: 50, innovation: 60,
                education: 50, policyMaking: 20, implementation: 30, succession: 40,
            }),
            createIndividual(3, 'ç”°ä¸­ï¼ˆä¿®å£«ï¼‰', 'university', 'university_student_master', 24, 1, {
                basicScience: 45, appliedTech: 35, digitalAI: 50, manufacturing: 20,
                finance: 10, energy: 25, globalCompete: 30, innovation: 40,
                education: 15, policyMaking: 5, implementation: 15, succession: 10,
            }),
            createIndividual(4, 'ä½è—¤ï¼ˆè‹¥æ‰‹SEï¼‰', 'industry', 'industry_engineer', 26, 2, {
                basicScience: 30, appliedTech: 55, digitalAI: 70, manufacturing: 40,
                finance: 25, energy: 20, globalCompete: 35, innovation: 45,
                education: 10, policyMaking: 5, implementation: 60, succession: 15,
            }),
            createIndividual(5, 'é«˜æ©‹ï¼ˆã‚·ãƒ‹ã‚¢Engï¼‰', 'industry', 'industry_engineer', 45, 4, {
                basicScience: 40, appliedTech: 85, digitalAI: 60, manufacturing: 80,
                finance: 35, energy: 45, globalCompete: 50, innovation: 55,
                education: 30, policyMaking: 25, implementation: 85, succession: 70,
            }),
            createIndividual(6, 'æ¸¡è¾ºï¼ˆå®˜åƒšï¼‰', 'government', 'government_official', 40, 2, {
                basicScience: 25, appliedTech: 30, digitalAI: 35, manufacturing: 20,
                finance: 70, energy: 55, globalCompete: 45, innovation: 30,
                education: 25, policyMaking: 80, implementation: 60, succession: 25,
            }),
        ];

        // å›½åŠ›è¨ˆç®—
        const calculateNationalCapability = (individuals) => {
            const capability = {};
            CAPABILITY_AXES.forEach(axis => {
                const values = individuals.map(ind => ind.skills[axis.key] || 0);
                const sum = values.reduce((a, b) => a + Math.pow(b, 0.8), 0);
                const ces = Math.pow(sum, 1/0.8) / individuals.length;
                const min = Math.min(...values);
                capability[axis.key] = ces * 0.7 + min * 0.3;
            });
            return capability;
        };

        function TalentDevelopmentSimulatorV2() {
            const [year, setYear] = useState(0);
            const [individuals, setIndividuals] = useState(initialIndividuals);
            const [capability, setCapability] = useState(() => calculateNationalCapability(initialIndividuals));
            const [investments, setInvestments] = useState({
                university: 30,
                industry: 35,
                government: 15,
                research: 20,
            });

            // ã‚¹ã‚³ã‚¢è¨ˆç®—
            const calculateScore = (cap) => {
                const values = Object.values(cap);
                const avg = values.reduce((a, b) => a + b, 0) / values.length;
                const min = Math.min(...values);
                return Math.round(avg * 0.6 + min * 0.4);
            };

            // æŠ€è¡“ç¶™æ‰¿æ€§ã‚¹ã‚³ã‚¢è¨ˆç®—
            const calculateSuccessionScore = (individuals) => {
                let score = 0;
                const sectors = ['university', 'industry', 'government'];
                
                sectors.forEach(sector => {
                    const sectorPeople = individuals.filter(i => i.sector === sector);
                    if (sectorPeople.length === 0) return;
                    
                    const ages = sectorPeople.map(p => p.age);
                    const ageRange = Math.max(...ages) - Math.min(...ages);
                    const ageScore = Math.min(40, ageRange) / 40 * 30;
                    
                    const tenureMargin = sectorPeople.reduce((sum, p) => {
                        return sum + Math.max(0, p.maxTenure - p.tenure) / p.maxTenure;
                    }, 0) / sectorPeople.length;
                    const tenureScore = tenureMargin * 40;
                    
                    const highSkillCount = sectorPeople.filter(p => 
                        Object.values(p.skills).reduce((a,b) => a+b, 0) / CAPABILITY_AXES.length > 50
                    ).length;
                    const mentorScore = (highSkillCount / sectorPeople.length) * 30;
                    
                    score += (ageScore + tenureScore + mentorScore) / 3;
                });
                
                return score / sectors.length;
            };

            // 1å¹´åˆ†ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
            const simulateYear = () => {
                setIndividuals(prev => {
                    const newIndividuals = [...prev];
                    
                    // å¹´é½¢ã¨åœ¨ç±å¹´æ•°ã®æ›´æ–°
                    newIndividuals.forEach(person => {
                        person.age++;
                        person.tenure++;
                    });

                    // é€€è·ãƒ»å’æ¥­å‡¦ç†
                    const remainingIndividuals = newIndividuals.filter(person => {
                        return person.tenure < person.maxTenure;
                    });

                    // æ–°è¦äººæã®è¿½åŠ 
                    if (Math.random() < 0.3) {
                        const sectors = ['university', 'industry', 'government'];
                        const randomSector = sectors[Math.floor(Math.random() * sectors.length)];
                        const roles = {
                            university: ['university_student_master', 'university_student_doctor'],
                            industry: ['industry_engineer'],
                            government: ['government_official']
                        };
                        const randomRole = roles[randomSector][Math.floor(Math.random() * roles[randomSector].length)];
                        
                        const randomSkills = {};
                        CAPABILITY_AXES.forEach(axis => {
                            randomSkills[axis.key] = Math.floor(Math.random() * 60) + 20;
                        });

                        remainingIndividuals.push(createIndividual(
                            Date.now(),
                            `æ–°äºº${Date.now()}`,
                            randomSector,
                            randomRole,
                            22 + Math.floor(Math.random() * 8),
                            0,
                            randomSkills
                        ));
                    }

                    return remainingIndividuals;
                });

                setYear(prev => prev + 1);
            };

            // å›½åŠ›ã®æ›´æ–°
            useEffect(() => {
                setCapability(calculateNationalCapability(individuals));
            }, [individuals]);

            // ãƒ¬ãƒ¼ãƒ€ãƒ¼ãƒãƒ£ãƒ¼ãƒˆãƒ‡ãƒ¼ã‚¿
            const radarData = CAPABILITY_AXES.map(axis => ({
                name: axis.name,
                current: capability[axis.key] || 0,
                target: 80
            }));

            return (
                <div className="container">
                    <h1>ğŸŒ å›½å®¶äººæè‚²æˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ v2</h1>
                    <p style={{textAlign: 'center', color: '#6c757d', marginBottom: '30px'}}>
                        Individual Profile Tracking & Succession Analysis
                    </p>
                    
                    <div className="stats">
                        <div className="stat-card">
                            <div className="stat-value">{calculateScore(capability)}</div>
                            <div className="stat-label">ç·åˆå›½åŠ›ã‚¹ã‚³ã‚¢</div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-value">{individuals.length}</div>
                            <div className="stat-label">ç·äººææ•°</div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-value">{calculateSuccessionScore(individuals).toFixed(1)}</div>
                            <div className="stat-label">æŠ€è¡“ç¶™æ‰¿æ€§</div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-value">{year}</div>
                            <div className="stat-label">çµŒéå¹´æ•°</div>
                        </div>
                    </div>

                    <div className="controls">
                        <div className="control-section">
                            <h3>ğŸ’° æŠ•è³‡é…åˆ†</h3>
                            {Object.entries(investments).map(([key, value]) => (
                                <div key={key} className="slider-container">
                                    <div className="slider-label">
                                        <span>{key === 'university' ? 'ğŸ“ å¤§å­¦' : 
                                               key === 'industry' ? 'ğŸ­ ç”£æ¥­' : 
                                               key === 'government' ? 'ğŸ›ï¸ æ”¿åºœ' : 'ğŸ”¬ ç ”ç©¶'}</span>
                                        <span>{value}%</span>
                                    </div>
                                    <input
                                        type="range"
                                        className="slider"
                                        min="0"
                                        max="100"
                                        value={value}
                                        onChange={(e) => setInvestments(prev => ({
                                            ...prev,
                                            [key]: parseInt(e.target.value)
                                        }))}
                                    />
                                </div>
                            ))}
                        </div>
                    </div>

                    <div className="buttons">
                        <button onClick={simulateYear}>1å¹´é€²ã‚ã‚‹</button>
                        <button onClick={() => {
                            setYear(0);
                            setIndividuals(initialIndividuals);
                        }}>
                            ãƒªã‚»ãƒƒãƒˆ
                        </button>
                    </div>

                    {ResponsiveContainer && (
                        <div className="chart-container">
                            <ResponsiveContainer width="100%" height="100%">
                                <RadarChart data={radarData}>
                                    <PolarGrid />
                                    <PolarAngleAxis dataKey="name" />
                                    <PolarRadiusAxis angle={0} domain={[0, 100]} />
                                    <Radar name="ç¾åœ¨" dataKey="current" stroke="#8884d8" fill="#8884d8" fillOpacity={0.3} />
                                    <Radar name="ç›®æ¨™" dataKey="target" stroke="#82ca9d" fill="#82ca9d" fillOpacity={0.1} />
                                    <Legend />
                                </RadarChart>
                            </ResponsiveContainer>
                        </div>
                    )}

                    <div className="individuals">
                        <h3>ğŸ‘¥ å€‹äººãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ« ({individuals.length}å)</h3>
                        <div className="individual-grid">
                            {individuals.map(person => (
                                <div key={person.id} className="individual-card">
                                    <div className="individual-name">{person.name}</div>
                                    <div className="individual-info">
                                        {SECTOR_TENURE[person.role]?.name || person.role} | {person.age}æ­³
                                    </div>
                                    <div className="individual-info">
                                        åœ¨ç±: {person.tenure}/{person.maxTenure}å¹´ | ç¶™æ‰¿æ€§: {person.skills.succession}
                                    </div>
                                    <div className="individual-info">
                                        ä¸»è¦ã‚¹ã‚­ãƒ«: åŸºç¤ç§‘å­¦({person.skills.basicScience}) 
                                        ãƒ‡ã‚¸ã‚¿ãƒ«AI({person.skills.digitalAI})
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        }

        // ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
        ReactDOM.render(<TalentDevelopmentSimulatorV2 />, document.getElementById('root'));
    </script>
</body>
</html>