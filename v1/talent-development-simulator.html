<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å›½å®¶äººæè‚²æˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { background: #111827; color: white; }
    input[type="range"] {
      -webkit-appearance: none;
      height: 8px;
      background: #374151;
      border-radius: 4px;
    }
    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 16px;
      height: 16px;
      background: #3b82f6;
      border-radius: 50%;
      cursor: pointer;
    }
  </style>
</head>
<body class="min-h-screen p-4">
  <h1 class="text-3xl font-bold text-center mb-2 text-cyan-400">ğŸŒ å›½å®¶äººæè‚²æˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</h1>
  <p class="text-center text-gray-400 mb-4">Human Capital Development Optimization Game</p>

  <!-- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼ -->
  <div class="grid grid-cols-4 gap-4 mb-6">
    <div class="bg-gray-800 rounded-lg p-4 text-center">
      <div class="text-2xl font-bold text-yellow-400" id="year-display">0å¹´ç›®</div>
      <div class="text-gray-400 text-sm">çµŒéå¹´æ•°</div>
    </div>
    <div class="bg-gray-800 rounded-lg p-4 text-center">
      <div class="text-2xl font-bold text-green-400" id="budget-display">1000</div>
      <div class="text-gray-400 text-sm">äºˆç®—æ®‹é«˜</div>
    </div>
    <div class="bg-gray-800 rounded-lg p-4 text-center">
      <div class="text-2xl font-bold text-blue-400" id="score-display">0</div>
      <div class="text-gray-400 text-sm">ç·åˆå›½åŠ›ã‚¹ã‚³ã‚¢</div>
    </div>
    <div class="bg-gray-800 rounded-lg p-4 text-center">
      <div class="text-2xl font-bold text-purple-400" id="achievement-display">0%</div>
      <div class="text-gray-400 text-sm">ç›®æ¨™é”æˆåº¦</div>
    </div>
  </div>

  <!-- ãƒ¬ãƒ¼ãƒ€ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
    <div class="bg-gray-800 rounded-lg p-4">
      <h2 class="text-xl font-bold mb-4 text-cyan-300">ğŸ“Š ç¾åœ¨ã®å›½åŠ›ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«</h2>
      <canvas id="current-radar"></canvas>
    </div>
    <div class="bg-gray-800 rounded-lg p-4">
      <h2 class="text-xl font-bold mb-4 text-orange-300">ğŸ”® å°†æ¥äºˆæ¸¬ï¼ˆ5å¹´å¾Œãƒ»10å¹´å¾Œï¼‰</h2>
      <canvas id="future-radar"></canvas>
    </div>
  </div>

  <!-- æŠ•è³‡é…åˆ† -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6">
    <div class="bg-gray-800 rounded-lg p-4">
      <h2 class="text-xl font-bold mb-4 text-green-300">ğŸ’° æŠ•è³‡é…åˆ† (ã‚»ã‚¯ã‚¿ãƒ¼åˆ¥)</h2>
      <div id="investment-controls"></div>
      <div class="text-right mt-4">
        <span id="investment-total" class="font-bold text-green-400">åˆè¨ˆ: 100%</span>
      </div>
    </div>
    <div class="bg-gray-800 rounded-lg p-4">
      <h2 class="text-xl font-bold mb-4 text-purple-300">ğŸ‘¥ äººæé…åˆ† (å¤§å­¦â†’å„ã‚»ã‚¯ã‚¿ãƒ¼)</h2>
      <div id="talent-controls"></div>
      <div class="text-right mt-4">
        <span id="talent-total" class="font-bold text-green-400">åˆè¨ˆ: 100%</span>
      </div>
    </div>
  </div>

  <!-- æ™‚ç³»åˆ—ã‚°ãƒ©ãƒ• -->
  <div class="bg-gray-800 rounded-lg p-4 mt-6">
    <h2 class="text-xl font-bold mb-4 text-yellow-300">ğŸ“ˆ å›½åŠ›æ¨ç§»ï¼ˆæ™‚ç³»åˆ—ï¼‰</h2>
    <div style="height: 300px;"><canvas id="history-chart"></canvas></div>
  </div>

  <!-- èƒ½åŠ›å€¤è©³ç´° -->
  <div class="bg-gray-800 rounded-lg p-4 mt-6">
    <h2 class="text-xl font-bold mb-4 text-pink-300">ğŸ“‹ èƒ½åŠ›å€¤è©³ç´°</h2>
    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3" id="capability-details"></div>
  </div>

  <!-- ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒœã‚¿ãƒ³ -->
  <div class="flex justify-center gap-4 mt-6 mb-8">
    <button id="btn-step" class="px-6 py-3 bg-blue-600 hover:bg-blue-700 rounded-lg font-bold transition">â–¶ï¸ 1å¹´é€²ã‚ã‚‹</button>
    <button id="btn-auto" class="px-6 py-3 bg-green-600 hover:bg-green-700 rounded-lg font-bold transition">â© è‡ªå‹•ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</button>
    <button id="btn-reset" class="px-6 py-3 bg-gray-600 hover:bg-gray-700 rounded-lg font-bold transition">ğŸ”„ ãƒªã‚»ãƒƒãƒˆ</button>
  </div>

  <!-- æ•°ç†ãƒ¢ãƒ‡ãƒ«èª¬æ˜ -->
  <div class="bg-gray-800 rounded-lg p-4 mt-6">
    <h2 class="text-xl font-bold mb-4 text-cyan-300">ğŸ“ æ•°ç†ãƒ¢ãƒ‡ãƒ«æ¦‚è¦</h2>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-300">
      <div>
        <h3 class="font-bold text-white mb-2">å›½åŠ›é›†ç´„é–¢æ•°</h3>
        <p class="font-mono bg-gray-900 p-2 rounded text-xs">S_j(t) = (Î£ s_i,j^Î±)^(1/Î±) Ã— Î (1 - e^(-Î²s_k,j))</p>
        <p class="mt-2">Î± &lt; 1 ã§è£œå®Œæ€§ã€ã‚­ãƒ¼ãƒ‘ãƒ¼ã‚½ãƒ³æ¬ æã§æ€¥æ¿€ãªä½ä¸‹</p>
      </div>
      <div>
        <h3 class="font-bold text-white mb-2">ç›®æ¨™é”æˆåº¦ï¼ˆã‚³ã‚µã‚¤ãƒ³é¡ä¼¼åº¦ï¼‰</h3>
        <p class="font-mono bg-gray-900 p-2 rounded text-xs">Achievement = (SÂ·S_target) / (|S||S_target|) Ã— 100%</p>
        <p class="mt-2">ãƒ™ã‚¯ãƒˆãƒ«æ–¹å‘ã®ä¸€è‡´åº¦ã§è©•ä¾¡</p>
      </div>
      <div>
        <h3 class="font-bold text-white mb-2">æˆé•·ãƒ¢ãƒ‡ãƒ«</h3>
        <p class="font-mono bg-gray-900 p-2 rounded text-xs">ds/dt = Î·Ã—T + Î³Ã—W + Î£(MÃ—Î´Ã—s) - Î¼Ã—s</p>
        <p class="mt-2">è‚²æˆ + OJT + ãƒ¡ãƒ³ã‚¿ãƒªãƒ³ã‚° - é™³è…åŒ–</p>
      </div>
      <div>
        <h3 class="font-bold text-white mb-2">æœ€é©åŒ–ç›®çš„é–¢æ•°</h3>
        <p class="font-mono bg-gray-900 p-2 rounded text-xs">min J = âˆ«[wâ‚â€–S-S_targetâ€–Â² + wâ‚‚Î£I + wâ‚ƒVar + wâ‚„Risk]dt</p>
        <p class="mt-2">ç›®æ¨™ä¹–é›¢ + ã‚³ã‚¹ãƒˆ + ãƒãƒ©ãƒ³ã‚¹ + ãƒªã‚¹ã‚¯</p>
      </div>
    </div>
  </div>

<script>
// å®šæ•°
const CAPABILITY_AXES = [
  { key: 'basicScience', name: 'åŸºç¤ç§‘å­¦' },
  { key: 'appliedTech', name: 'å¿œç”¨æŠ€è¡“' },
  { key: 'digitalAI', name: 'ãƒ‡ã‚¸ã‚¿ãƒ«ãƒ»AI' },
  { key: 'manufacturing', name: 'è£½é€ ãƒ»ã‚‚ã®ã¥ãã‚Š' },
  { key: 'finance', name: 'é‡‘èãƒ»çµŒæ¸ˆ' },
  { key: 'healthcare', name: 'åŒ»ç™‚ãƒ»ãƒ˜ãƒ«ã‚¹ã‚±ã‚¢' },
  { key: 'energy', name: 'ã‚¨ãƒãƒ«ã‚®ãƒ¼ãƒ»ç’°å¢ƒ' },
  { key: 'globalCompete', name: 'å›½éš›ç«¶äº‰åŠ›' },
  { key: 'innovation', name: 'ã‚¤ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³' },
  { key: 'education', name: 'æ•™è‚²åŸºç›¤' },
  { key: 'policyMaking', name: 'æ”¿ç­–ç«‹æ¡ˆ' },
  { key: 'implementation', name: 'ç¤¾ä¼šå®Ÿè£…åŠ›' },
];

const initialCapability = {
  basicScience: 70, appliedTech: 65, digitalAI: 55, manufacturing: 75,
  finance: 60, healthcare: 70, energy: 50, globalCompete: 45,
  innovation: 50, education: 65, policyMaking: 55, implementation: 60,
};

const targetCapability = {
  basicScience: 85, appliedTech: 85, digitalAI: 90, manufacturing: 80,
  finance: 75, healthcare: 85, energy: 80, globalCompete: 75,
  innovation: 85, education: 80, policyMaking: 70, implementation: 80,
};

const SECTORS = {
  university: { name: 'å¤§å­¦ãƒ»ç ”ç©¶æ©Ÿé–¢', icon: 'ğŸ“', desc: 'åŸºç¤ç ”ç©¶ãƒ»äººæè‚²æˆã®åœŸå°' },
  industry: { name: 'ç”£æ¥­ç•Œ', icon: 'ğŸ­', desc: 'çµŒé¨“çš„æŠ€è¡“ãƒ»å®Ÿè·µçŸ¥ã®è“„ç©' },
  government: { name: 'æ”¿åºœãƒ»æ”¿ç­–', icon: 'ğŸ›ï¸', desc: 'æŠ•è³‡é…åˆ†ãƒ»åˆ¶åº¦è¨­è¨ˆ' },
  research: { name: 'å¤–éƒ¨ç ”ç©¶è€…', icon: 'ğŸ”¬', desc: 'é«˜åº¦å°‚é–€çŸ¥è­˜ãƒ»å›½éš›é€£æº' },
};

// çŠ¶æ…‹
let state = {
  year: 0,
  budget: 1000,
  capability: JSON.parse(JSON.stringify(initialCapability)),
  history: [],
  isSimulating: false,
  investments: { university: 30, industry: 35, government: 15, research: 20 },
  talentAllocation: { toIndustry: 50, toGovernment: 20, toResearch: 30 },
  keyPersonRisk: {},
};

// ãƒãƒ£ãƒ¼ãƒˆ
let currentRadarChart, futureRadarChart, historyChart;

// è¨ˆç®—é–¢æ•°
function calculateScore(cap) {
  const values = Object.values(cap);
  const avg = values.reduce((a, b) => a + b, 0) / values.length;
  const min = Math.min(...values);
  return Math.round(avg * 0.6 + min * 0.4);
}

function calculateAchievement(cap) {
  let dot = 0, normCap = 0, normTarget = 0;
  CAPABILITY_AXES.forEach(axis => {
    dot += cap[axis.key] * targetCapability[axis.key];
    normCap += cap[axis.key] ** 2;
    normTarget += targetCapability[axis.key] ** 2;
  });
  return (dot / (Math.sqrt(normCap) * Math.sqrt(normTarget)) * 100).toFixed(1);
}

function predictFuture(years) {
  const recent = state.history.slice(-3);
  if (recent.length < 2) return state.capability;
  const prediction = {};
  CAPABILITY_AXES.forEach(axis => {
    const values = recent.map(h => h[axis.key] || 0);
    const trend = (values[values.length - 1] - values[0]) / values.length;
    prediction[axis.key] = Math.max(0, Math.min(100, state.capability[axis.key] + trend * years));
  });
  return prediction;
}

// ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
function simulateYear() {
  const inv = state.investments;
  const tal = state.talentAllocation;
  const cap = state.capability;
  
  // å¤§å­¦åŠ¹æœ
  const uniEffect = inv.university / 100;
  cap.basicScience += uniEffect * 3 * (1 + tal.toResearch / 100);
  cap.education += uniEffect * 2;
  cap.innovation += uniEffect * 1.5;
  
  // ç”£æ¥­ç•ŒåŠ¹æœ
  const indEffect = inv.industry / 100;
  cap.appliedTech += indEffect * 3;
  cap.manufacturing += indEffect * 2.5;
  cap.digitalAI += indEffect * 2;
  cap.implementation += indEffect * 2;
  
  // æ”¿åºœåŠ¹æœ
  const govEffect = inv.government / 100;
  cap.policyMaking += govEffect * 2;
  cap.finance += govEffect * 1.5;
  
  // ç ”ç©¶åŠ¹æœ
  const resEffect = inv.research / 100;
  cap.globalCompete += resEffect * 3;
  cap.healthcare += resEffect * 2;
  cap.energy += resEffect * 2;
  
  // ã‚·ãƒŠã‚¸ãƒ¼
  const synergy = (tal.toIndustry * tal.toResearch) / 10000;
  cap.innovation += synergy * 1.5;
  cap.implementation += synergy * 1;
  
  // é™³è…åŒ– & ã‚¯ãƒªãƒƒãƒ—
  Object.keys(cap).forEach(key => {
    cap[key] = Math.max(0, Math.min(100, cap[key] - 1 + Math.random() * 0.5));
    state.keyPersonRisk[key] = cap[key] > 80 ? 'high' : cap[key] > 60 ? 'medium' : 'low';
  });
  
  // äºˆç®—
  const income = calculateScore(cap) * 2;
  const totalInv = Object.values(inv).reduce((a, b) => a + b, 0);
  state.budget = Math.max(0, state.budget + income - totalInv * 3);
  
  state.year += 1;
  state.history.push({ year: state.year, ...cap, totalScore: calculateScore(cap) });
  
  updateUI();
}

// UIæ›´æ–°
function updateUI() {
  document.getElementById('year-display').textContent = `${state.year}å¹´ç›®`;
  document.getElementById('budget-display').textContent = state.budget.toFixed(0);
  document.getElementById('score-display').textContent = calculateScore(state.capability);
  document.getElementById('achievement-display').textContent = `${calculateAchievement(state.capability)}%`;
  
  updateRadars();
  updateHistoryChart();
  updateCapabilityDetails();
  updateTotals();
}

function updateRadars() {
  const labels = CAPABILITY_AXES.map(a => a.name);
  const current = CAPABILITY_AXES.map(a => state.capability[a.key]);
  const target = CAPABILITY_AXES.map(a => targetCapability[a.key]);
  const initial = CAPABILITY_AXES.map(a => initialCapability[a.key]);
  
  currentRadarChart.data.labels = labels;
  currentRadarChart.data.datasets[0].data = current;
  currentRadarChart.data.datasets[1].data = target;
  currentRadarChart.data.datasets[2].data = initial;
  currentRadarChart.update();
  
  const future5 = predictFuture(5);
  const future10 = predictFuture(10);
  
  futureRadarChart.data.labels = labels;
  futureRadarChart.data.datasets[0].data = current;
  futureRadarChart.data.datasets[1].data = CAPABILITY_AXES.map(a => future5[a.key]);
  futureRadarChart.data.datasets[2].data = CAPABILITY_AXES.map(a => future10[a.key]);
  futureRadarChart.data.datasets[3].data = target;
  futureRadarChart.update();
}

function updateHistoryChart() {
  historyChart.data.labels = state.history.map(h => h.year);
  historyChart.data.datasets[0].data = state.history.map(h => h.totalScore);
  historyChart.data.datasets[1].data = state.history.map(h => h.basicScience);
  historyChart.data.datasets[2].data = state.history.map(h => h.digitalAI);
  historyChart.data.datasets[3].data = state.history.map(h => h.innovation);
  historyChart.update();
}

function updateCapabilityDetails() {
  const container = document.getElementById('capability-details');
  container.innerHTML = CAPABILITY_AXES.map(axis => {
    const current = state.capability[axis.key];
    const target = targetCapability[axis.key];
    const gap = target - current;
    const risk = state.keyPersonRisk[axis.key];
    const color = current >= target ? '#4ade80' : current >= target * 0.8 ? '#fbbf24' : '#f87171';
    
    return `
      <div class="bg-gray-700 rounded p-3">
        <div class="flex justify-between items-center mb-2">
          <span class="text-sm font-medium">${axis.name}</span>
          ${risk === 'high' ? '<span class="text-red-400 text-xs">âš ï¸ é«˜ä¾å­˜</span>' : ''}
        </div>
        <div class="text-2xl font-bold" style="color: ${color}">${current.toFixed(1)}</div>
        <div class="text-xs text-gray-400">ç›®æ¨™: ${target} (${gap > 0 ? '-' + gap.toFixed(1) : '+' + Math.abs(gap).toFixed(1)})</div>
        <div class="w-full bg-gray-600 rounded-full h-2 mt-2">
          <div class="h-2 rounded-full" style="width: ${Math.min(100, (current / target) * 100)}%; background: ${color}"></div>
        </div>
      </div>
    `;
  }).join('');
}

function updateTotals() {
  const invTotal = Object.values(state.investments).reduce((a, b) => a + b, 0);
  const talTotal = Object.values(state.talentAllocation).reduce((a, b) => a + b, 0);
  
  const invEl = document.getElementById('investment-total');
  invEl.textContent = `åˆè¨ˆ: ${invTotal}%`;
  invEl.className = `font-bold ${invTotal === 100 ? 'text-green-400' : 'text-red-400'}`;
  
  const talEl = document.getElementById('talent-total');
  talEl.textContent = `åˆè¨ˆ: ${talTotal}%`;
  talEl.className = `font-bold ${talTotal === 100 ? 'text-green-400' : 'text-red-400'}`;
}

// åˆæœŸåŒ–
function initCharts() {
  const radarOptions = {
    responsive: true,
    scales: {
      r: {
        beginAtZero: true,
        max: 100,
        ticks: { color: '#666', font: { size: 9 } },
        grid: { color: '#444' },
        angleLines: { color: '#444' },
        pointLabels: { color: '#aaa', font: { size: 10 } }
      }
    },
    plugins: { legend: { labels: { color: '#ccc' } } }
  };
  
  currentRadarChart = new Chart(document.getElementById('current-radar'), {
    type: 'radar',
    data: {
      labels: CAPABILITY_AXES.map(a => a.name),
      datasets: [
        { label: 'ç¾åœ¨', data: [], borderColor: '#00ffff', backgroundColor: '#00ffff30', borderWidth: 2 },
        { label: 'ç›®æ¨™', data: [], borderColor: '#ff6b6b', backgroundColor: '#ff6b6b10', borderWidth: 2, borderDash: [5, 5] },
        { label: 'åˆæœŸ', data: [], borderColor: '#888', backgroundColor: 'transparent', borderWidth: 1, borderDash: [3, 3] }
      ]
    },
    options: radarOptions
  });
  
  futureRadarChart = new Chart(document.getElementById('future-radar'), {
    type: 'radar',
    data: {
      labels: CAPABILITY_AXES.map(a => a.name),
      datasets: [
        { label: 'ç¾åœ¨', data: [], borderColor: '#00ffff', backgroundColor: '#00ffff20', borderWidth: 1 },
        { label: '5å¹´å¾Œ', data: [], borderColor: '#ffd700', backgroundColor: '#ffd70020', borderWidth: 2 },
        { label: '10å¹´å¾Œ', data: [], borderColor: '#ff4500', backgroundColor: '#ff450020', borderWidth: 2 },
        { label: 'ç›®æ¨™', data: [], borderColor: '#888', backgroundColor: 'transparent', borderWidth: 1, borderDash: [5, 5] }
      ]
    },
    options: radarOptions
  });
  
  historyChart = new Chart(document.getElementById('history-chart'), {
    type: 'line',
    data: {
      labels: [],
      datasets: [
        { label: 'ç·åˆã‚¹ã‚³ã‚¢', data: [], borderColor: '#00ffff', borderWidth: 3, pointRadius: 0 },
        { label: 'åŸºç¤ç§‘å­¦', data: [], borderColor: '#8884d8', borderWidth: 1, pointRadius: 0 },
        { label: 'ãƒ‡ã‚¸ã‚¿ãƒ«ãƒ»AI', data: [], borderColor: '#ffc658', borderWidth: 1, pointRadius: 0 },
        { label: 'ã‚¤ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³', data: [], borderColor: '#82ca9d', borderWidth: 1, pointRadius: 0 }
      ]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      scales: {
        x: { ticks: { color: '#888' }, grid: { color: '#444' } },
        y: { min: 0, max: 100, ticks: { color: '#888' }, grid: { color: '#444' } }
      },
      plugins: { legend: { labels: { color: '#ccc' } } }
    }
  });
}

function initControls() {
  // æŠ•è³‡é…åˆ†
  document.getElementById('investment-controls').innerHTML = Object.entries(SECTORS).map(([key, s]) => `
    <div class="mb-4">
      <div class="flex justify-between items-center mb-1">
        <span>${s.icon} ${s.name}</span>
        <span class="text-yellow-400 font-bold" id="inv-${key}-val">${state.investments[key]}%</span>
      </div>
      <input type="range" min="0" max="100" value="${state.investments[key]}"
        class="w-full" oninput="updateInvestment('${key}', this.value)">
      <p class="text-gray-500 text-xs mt-1">${s.desc}</p>
    </div>
  `).join('');
  
  // äººæé…åˆ†
  const talents = [
    { key: 'toIndustry', icon: 'ğŸ­', name: 'ç”£æ¥­ç•Œ', color: 'text-blue-400' },
    { key: 'toGovernment', icon: 'ğŸ›ï¸', name: 'æ”¿åºœãƒ»å®˜åƒš', color: 'text-green-400' },
    { key: 'toResearch', icon: 'ğŸ”¬', name: 'ç ”ç©¶æ©Ÿé–¢', color: 'text-purple-400' }
  ];
  
  document.getElementById('talent-controls').innerHTML = talents.map(t => `
    <div class="mb-4">
      <div class="flex justify-between items-center mb-1">
        <span>${t.icon} â†’ ${t.name}</span>
        <span class="${t.color} font-bold" id="tal-${t.key}-val">${state.talentAllocation[t.key]}%</span>
      </div>
      <input type="range" min="0" max="100" value="${state.talentAllocation[t.key]}"
        class="w-full" oninput="updateTalent('${t.key}', this.value)">
    </div>
  `).join('');
}

function updateInvestment(key, value) {
  state.investments[key] = parseInt(value);
  document.getElementById(`inv-${key}-val`).textContent = `${value}%`;
  updateTotals();
}

function updateTalent(key, value) {
  state.talentAllocation[key] = parseInt(value);
  document.getElementById(`tal-${key}-val`).textContent = `${value}%`;
  updateTotals();
}

function resetSimulation() {
  state = {
    year: 0,
    budget: 1000,
    capability: JSON.parse(JSON.stringify(initialCapability)),
    history: [{ year: 0, ...initialCapability, totalScore: calculateScore(initialCapability) }],
    isSimulating: false,
    investments: { university: 30, industry: 35, government: 15, research: 20 },
    talentAllocation: { toIndustry: 50, toGovernment: 20, toResearch: 30 },
    keyPersonRisk: {},
  };
  initControls();
  updateUI();
  
  document.getElementById('btn-auto').textContent = 'â© è‡ªå‹•ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³';
  document.getElementById('btn-auto').classList.remove('bg-red-600', 'hover:bg-red-700');
  document.getElementById('btn-auto').classList.add('bg-green-600', 'hover:bg-green-700');
}

let autoInterval = null;

function toggleAuto() {
  state.isSimulating = !state.isSimulating;
  const btn = document.getElementById('btn-auto');
  
  if (state.isSimulating) {
    btn.textContent = 'â¸ï¸ åœæ­¢';
    btn.classList.remove('bg-green-600', 'hover:bg-green-700');
    btn.classList.add('bg-red-600', 'hover:bg-red-700');
    autoInterval = setInterval(() => {
      if (state.year >= 20) { toggleAuto(); return; }
      simulateYear();
    }, 500);
  } else {
    btn.textContent = 'â© è‡ªå‹•ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³';
    btn.classList.remove('bg-red-600', 'hover:bg-red-700');
    btn.classList.add('bg-green-600', 'hover:bg-green-700');
    if (autoInterval) { clearInterval(autoInterval); autoInterval = null; }
  }
}

// ã‚¤ãƒ™ãƒ³ãƒˆ
document.getElementById('btn-step').addEventListener('click', simulateYear);
document.getElementById('btn-auto').addEventListener('click', toggleAuto);
document.getElementById('btn-reset').addEventListener('click', resetSimulation);

// èµ·å‹•
document.addEventListener('DOMContentLoaded', () => {
  initCharts();
  initControls();
  state.history = [{ year: 0, ...initialCapability, totalScore: calculateScore(initialCapability) }];
  updateUI();
});
</script>
</body>
</html>
