<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äººæè‚²æˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ v3</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Hiragino Sans', 'Yu Gothic', sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .control-group {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
        }
        
        .control-group h3 {
            margin-top: 0;
            color: #2c3e50;
        }
        
        .slider {
            width: 100%;
            margin: 10px 0;
        }
        
        .chart-container {
            margin: 20px 0;
            height: 400px;
            position: relative;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: #f1f2f6;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 1.8em;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .stat-label {
            color: #7f8c8d;
            margin-top: 5px;
            font-size: 0.9em;
        }
        
        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        
        button:hover {
            background: #2980b9;
        }
        
        .year-display {
            text-align: center;
            font-size: 1.5em;
            margin: 20px 0;
            color: #2c3e50;
        }
        
        .cohort-display {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .cohort-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .cohort-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #ddd;
        }
        
        .cohort-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #2c3e50;
        }
        
        .age-group {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
            font-size: 0.9em;
        }
        
        .progress-bar {
            width: 100%;
            height: 10px;
            background: #e9ecef;
            border-radius: 5px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: #3498db;
            transition: width 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 style="text-align: center; color: #2c3e50;">ğŸŒ å›½å®¶äººæè‚²æˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ v3</h1>
        <p style="text-align: center; color: #7f8c8d;">å¤§è¦æ¨¡ã‚³ãƒ›ãƒ¼ãƒˆãƒ¢ãƒ‡ãƒ«ï¼ˆ46ä¸‡äººå¯¾å¿œï¼‰ãƒ»äººå£çµ±è¨ˆé€£å‹•</p>
        
        <div class="year-display" id="yearDisplay">
            å¹´åº¦: 0å¹´ç›®
        </div>

        <div class="stats">
            <div class="stat-card">
                <div class="stat-value" id="totalScore">63</div>
                <div class="stat-label">ç·åˆå›½åŠ›ã‚¹ã‚³ã‚¢</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="totalPopulation">320K</div>
                <div class="stat-label">ç·äººææ•°</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="industryPopulation">80K</div>
                <div class="stat-label">ç”£æ¥­ç•Œäººæ</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="universityPopulation">80K</div>
                <div class="stat-label">å¤§å­¦äººæ</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="researchPopulation">80K</div>
                <div class="stat-label">ç ”ç©¶æ©Ÿé–¢</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="minScore">45</div>
                <div class="stat-label">æœ€å¼±è»¸ã‚¹ã‚³ã‚¢</div>
            </div>
        </div>

        <div class="controls">
            <div class="control-group">
                <h3>æŠ•è³‡é…åˆ†</h3>
                <div>
                    <label id="uniLabel">ğŸ“ å¤§å­¦æŠ•è³‡: 30%</label>
                    <input type="range" class="slider" id="uniSlider" min="0" max="100" value="30" />
                </div>
                <div>
                    <label id="indLabel">ğŸ­ ç”£æ¥­æŠ•è³‡: 35%</label>
                    <input type="range" class="slider" id="indSlider" min="0" max="100" value="35" />
                </div>
                <div>
                    <label id="govLabel">ğŸ›ï¸ æ”¿åºœæŠ•è³‡: 15%</label>
                    <input type="range" class="slider" id="govSlider" min="0" max="100" value="15" />
                </div>
                <div>
                    <label id="resLabel">ğŸ”¬ ç ”ç©¶æŠ•è³‡: 20%</label>
                    <input type="range" class="slider" id="resSlider" min="0" max="100" value="20" />
                </div>
            </div>
        </div>

        <div style="text-align: center; margin: 20px 0;">
            <button onclick="simulateYear()">1å¹´é€²ã‚ã‚‹</button>
            <button onclick="resetSimulation()">ãƒªã‚»ãƒƒãƒˆ</button>
        </div>

        <div class="chart-container">
            <canvas id="radarChart"></canvas>
        </div>

        <div class="cohort-display">
            <h3>ã‚³ãƒ›ãƒ¼ãƒˆåˆ¥äººæåˆ†å¸ƒï¼ˆå¹´é½¢Ã—ã‚»ã‚¯ã‚¿ãƒ¼ï¼‰</h3>
            <div class="cohort-grid" id="cohortGrid">
                <!-- ã‚³ãƒ›ãƒ¼ãƒˆãƒ‡ãƒ¼ã‚¿ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã‚‹ -->
            </div>
        </div>
    </div>

    <script>
        // èƒ½åŠ›è»¸ã®å®šç¾©
        const CAPABILITY_AXES = [
            { key: 'basicScience', name: 'åŸºç¤ç§‘å­¦' },
            { key: 'appliedTech', name: 'å¿œç”¨æŠ€è¡“' },
            { key: 'digitalAI', name: 'ãƒ‡ã‚¸ã‚¿ãƒ«ãƒ»AI' },
            { key: 'manufacturing', name: 'è£½é€ ãƒ»ã‚‚ã®ã¥ãã‚Š' },
            { key: 'finance', name: 'é‡‘èãƒ»çµŒæ¸ˆ' },
            { key: 'healthcare', name: 'åŒ»ç™‚ãƒ»ãƒ˜ãƒ«ã‚¹ã‚±ã‚¢' },
            { key: 'energy', name: 'ã‚¨ãƒãƒ«ã‚®ãƒ¼ãƒ»ç’°å¢ƒ' },
            { key: 'globalCompete', name: 'å›½éš›ç«¶äº‰åŠ›' },
            { key: 'innovation', name: 'ã‚¤ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³' },
            { key: 'education', name: 'æ•™è‚²åŸºç›¤' },
            { key: 'policyMaking', name: 'æ”¿ç­–ç«‹æ¡ˆ' },
            { key: 'implementation', name: 'ç¤¾ä¼šå®Ÿè£…åŠ›' }
        ];

        // å¹´é½¢ã‚°ãƒ«ãƒ¼ãƒ—å®šç¾©
        const AGE_GROUPS = ['20-29', '30-39', '40-49', '50-59', '60+'];
        const SECTORS = ['university', 'industry', 'government', 'research'];
        
        const SECTOR_NAMES = {
            'university': 'å¤§å­¦',
            'industry': 'ç”£æ¥­ç•Œ',
            'government': 'æ”¿åºœ',
            'research': 'ç ”ç©¶æ©Ÿé–¢'
        };

        // åˆæœŸå›½åŠ›çŠ¶æ…‹
        const initialCapability = {
            basicScience: 70,
            appliedTech: 65,
            digitalAI: 55,
            manufacturing: 75,
            finance: 60,
            healthcare: 70,
            energy: 50,
            globalCompete: 45,
            innovation: 50,
            education: 65,
            policyMaking: 55,
            implementation: 60,
        };

        // ç¾åœ¨ã®çŠ¶æ…‹
        let year = 0;
        let capability = {...initialCapability};
        let investments = {
            university: 30,
            industry: 35,
            government: 15,
            research: 20,
        };
        
        // ã‚³ãƒ›ãƒ¼ãƒˆãƒ¢ãƒ‡ãƒ«ï¼ˆå¹´é½¢Ã—ã‚»ã‚¯ã‚¿ãƒ¼åˆ¥äººææ•°ï¼‰
        let cohorts = {};
        let chart = null;

        // åˆæœŸã‚³ãƒ›ãƒ¼ãƒˆç”Ÿæˆ
        function initializeCohorts() {
            cohorts = {};
            SECTORS.forEach(sector => {
                cohorts[sector] = {};
                AGE_GROUPS.forEach(ageGroup => {
                    cohorts[sector][ageGroup] = Math.floor(Math.random() * 10000) + 5000;
                });
            });
        }

        // ç·äººææ•°è¨ˆç®—
        function getTotalPopulation() {
            let total = 0;
            SECTORS.forEach(sector => {
                AGE_GROUPS.forEach(ageGroup => {
                    total += cohorts[sector][ageGroup];
                });
            });
            return total;
        }

        // ã‚»ã‚¯ã‚¿ãƒ¼åˆ¥äººææ•°è¨ˆç®—
        function getSectorPopulation(sector) {
            return AGE_GROUPS.reduce((total, ageGroup) => total + cohorts[sector][ageGroup], 0);
        }

        // ã‚¹ã‚³ã‚¢è¨ˆç®—
        function calculateScore(cap) {
            const values = Object.values(cap);
            const avg = values.reduce((a, b) => a + b, 0) / values.length;
            const min = Math.min(...values);
            return Math.round(avg * 0.6 + min * 0.4);
        }

        // çµ±è¨ˆæ›´æ–°
        function updateStats() {
            const values = Object.values(capability);
            const min = Math.min(...values);
            const total = calculateScore(capability);
            
            document.getElementById('totalScore').textContent = total;
            document.getElementById('totalPopulation').textContent = Math.floor(getTotalPopulation() / 1000) + 'K';
            document.getElementById('industryPopulation').textContent = Math.floor(getSectorPopulation('industry') / 1000) + 'K';
            document.getElementById('universityPopulation').textContent = Math.floor(getSectorPopulation('university') / 1000) + 'K';
            document.getElementById('researchPopulation').textContent = Math.floor(getSectorPopulation('research') / 1000) + 'K';
            document.getElementById('minScore').textContent = min.toFixed(0);
            document.getElementById('yearDisplay').textContent = `å¹´åº¦: ${year}å¹´ç›®`;
        }

        // ã‚³ãƒ›ãƒ¼ãƒˆè¡¨ç¤ºæ›´æ–°
        function updateCohortDisplay() {
            const gridElement = document.getElementById('cohortGrid');
            gridElement.innerHTML = '';
            
            const totalPop = getTotalPopulation();
            
            SECTORS.forEach(sector => {
                const card = document.createElement('div');
                card.className = 'cohort-card';
                
                const sectorPop = getSectorPopulation(sector);
                const percentage = ((sectorPop / totalPop) * 100).toFixed(1);
                
                let ageGroupsHTML = '';
                AGE_GROUPS.forEach(ageGroup => {
                    const count = Math.floor(cohorts[sector][ageGroup] / 1000);
                    ageGroupsHTML += `
                        <div class="age-group">
                            <span>${ageGroup}æ­³</span>
                            <span>${count}K</span>
                        </div>
                    `;
                });
                
                card.innerHTML = `
                    <div class="cohort-title">${SECTOR_NAMES[sector]}</div>
                    ${ageGroupsHTML}
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${percentage}%"></div>
                    </div>
                    <div style="text-align: center; font-size: 0.9em; margin-top: 5px;">
                        ${percentage}%
                    </div>
                `;
                
                gridElement.appendChild(card);
            });
        }

        // ãƒãƒ£ãƒ¼ãƒˆæ›´æ–°
        function updateChart() {
            const ctx = document.getElementById('radarChart');
            if (chart) {
                chart.destroy();
            }

            const data = {
                labels: CAPABILITY_AXES.map(axis => axis.name),
                datasets: [{
                    label: 'ç¾åœ¨ã®å›½åŠ›',
                    data: CAPABILITY_AXES.map(axis => capability[axis.key]),
                    backgroundColor: 'rgba(54, 162, 235, 0.2)',
                    borderColor: 'rgba(54, 162, 235, 1)',
                    pointBackgroundColor: 'rgba(54, 162, 235, 1)',
                }]
            };

            chart = new Chart(ctx, {
                type: 'radar',
                data: data,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                stepSize: 20
                            }
                        }
                    }
                }
            });
        }

        // 1å¹´åˆ†ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
        function simulateYear() {
            // å¤§å­¦æŠ•è³‡åŠ¹æœ
            const uniEffect = investments.university / 100;
            capability.basicScience += uniEffect * 3;
            capability.education += uniEffect * 2;
            capability.innovation += uniEffect * 1.5;
            
            // ç”£æ¥­ç•ŒæŠ•è³‡åŠ¹æœ
            const indEffect = investments.industry / 100;
            capability.appliedTech += indEffect * 3;
            capability.manufacturing += indEffect * 2.5;
            capability.digitalAI += indEffect * 2;
            capability.implementation += indEffect * 2;
            
            // æ”¿åºœæŠ•è³‡åŠ¹æœ
            const govEffect = investments.government / 100;
            capability.policyMaking += govEffect * 3;
            capability.finance += govEffect * 2;
            
            // ç ”ç©¶æŠ•è³‡åŠ¹æœ
            const resEffect = investments.research / 100;
            capability.globalCompete += resEffect * 3;
            capability.healthcare += resEffect * 2;
            capability.energy += resEffect * 2;
            
            // ã‚³ãƒ›ãƒ¼ãƒˆã‹ã‚‰ã®è²¢çŒ®åŠ¹æœ
            SECTORS.forEach(sector => {
                const sectorPop = getSectorPopulation(sector);
                const contribution = sectorPop / 100000; // äººææ•°ã«å¿œã˜ãŸè²¢çŒ®
                
                if (sector === 'university') {
                    capability.basicScience += contribution * 2;
                    capability.education += contribution * 1.5;
                } else if (sector === 'industry') {
                    capability.appliedTech += contribution * 2;
                    capability.manufacturing += contribution * 1.5;
                    capability.implementation += contribution;
                } else if (sector === 'government') {
                    capability.policyMaking += contribution * 2;
                    capability.finance += contribution;
                } else if (sector === 'research') {
                    capability.globalCompete += contribution * 2;
                    capability.innovation += contribution;
                }
            });
            
            // ä¸Šé™ã‚’100ã«åˆ¶é™
            Object.keys(capability).forEach(key => {
                capability[key] = Math.min(100, capability[key]);
            });
            
            // ã‚³ãƒ›ãƒ¼ãƒˆæ›´æ–°ï¼ˆå¹´é½¢æ¨ç§»ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
            const newCohorts = {...cohorts};
            
            SECTORS.forEach(sector => {
                const oldCohort = {...cohorts[sector]};
                
                // å¹´é½¢æ¨ç§»ï¼ˆç°¡ç•¥åŒ–ï¼‰
                newCohorts[sector]['20-29'] = Math.max(0, oldCohort['20-29'] * 0.95 + Math.floor(investments.university * 50));
                newCohorts[sector]['30-39'] = Math.max(0, oldCohort['30-39'] * 0.98 + oldCohort['20-29'] * 0.05);
                newCohorts[sector]['40-49'] = Math.max(0, oldCohort['40-49'] * 0.97 + oldCohort['30-39'] * 0.02);
                newCohorts[sector]['50-59'] = Math.max(0, oldCohort['50-59'] * 0.95 + oldCohort['40-49'] * 0.03);
                newCohorts[sector]['60+'] = Math.max(0, oldCohort['60+'] * 0.90 + oldCohort['50-59'] * 0.05);
            });
            
            cohorts = newCohorts;
            year++;
            updateStats();
            updateChart();
            updateCohortDisplay();
        }

        // ãƒªã‚»ãƒƒãƒˆ
        function resetSimulation() {
            year = 0;
            capability = {...initialCapability};
            initializeCohorts();
            updateStats();
            updateChart();
            updateCohortDisplay();
        }

        // ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆè¨­å®š
        function setupSliders() {
            document.getElementById('uniSlider').addEventListener('input', (e) => {
                investments.university = parseInt(e.target.value);
                document.getElementById('uniLabel').textContent = `ğŸ“ å¤§å­¦æŠ•è³‡: ${investments.university}%`;
            });

            document.getElementById('indSlider').addEventListener('input', (e) => {
                investments.industry = parseInt(e.target.value);
                document.getElementById('indLabel').textContent = `ğŸ­ ç”£æ¥­æŠ•è³‡: ${investments.industry}%`;
            });

            document.getElementById('govSlider').addEventListener('input', (e) => {
                investments.government = parseInt(e.target.value);
                document.getElementById('govLabel').textContent = `ğŸ›ï¸ æ”¿åºœæŠ•è³‡: ${investments.government}%`;
            });

            document.getElementById('resSlider').addEventListener('input', (e) => {
                investments.research = parseInt(e.target.value);
                document.getElementById('resLabel').textContent = `ğŸ”¬ ç ”ç©¶æŠ•è³‡: ${investments.research}%`;
            });
        }

        // åˆæœŸåŒ–
        window.addEventListener('load', () => {
            initializeCohorts();
            setupSliders();
            updateStats();
            updateChart();
            updateCohortDisplay();
        });
    </script>
</body>
</html>