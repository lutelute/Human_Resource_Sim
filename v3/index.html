<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äººæè‚²æˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ v3</title>
    <!-- React and ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <!-- Babel for JSX compilation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Recharts for React charts -->
    <script src="https://unpkg.com/recharts@2.8.0/umd/Recharts.js"></script>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        body {
            font-family: 'Hiragino Sans', 'Yu Gothic', sans-serif;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;
        const { 
            RadarChart, PolarGrid, PolarAngleAxis, PolarRadiusAxis, Radar, Legend, 
            ResponsiveContainer, LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip,
            BarChart, Bar, AreaChart, Area, ScatterChart, Scatter
        } = window.Recharts || {};

        // èƒ½åŠ›è»¸ã®å®šç¾©ï¼ˆ12è»¸ï¼‰
        const CAPABILITY_AXES = [
            { key: 'basicScience', name: 'åŸºç¤ç§‘å­¦', color: '#8884d8' },
            { key: 'appliedTech', name: 'å¿œç”¨æŠ€è¡“', color: '#82ca9d' },
            { key: 'digitalAI', name: 'ãƒ‡ã‚¸ã‚¿ãƒ«ãƒ»AI', color: '#ffc658' },
            { key: 'manufacturing', name: 'è£½é€ ãƒ»ã‚‚ã®ã¥ãã‚Š', color: '#ff7300' },
            { key: 'finance', name: 'é‡‘èãƒ»çµŒæ¸ˆ', color: '#00C49F' },
            { key: 'healthcare', name: 'åŒ»ç™‚ãƒ»ãƒ˜ãƒ«ã‚¹ã‚±ã‚¢', color: '#FFBB28' },
            { key: 'energy', name: 'ã‚¨ãƒãƒ«ã‚®ãƒ¼ãƒ»ç’°å¢ƒ', color: '#FF8042' },
            { key: 'globalCompete', name: 'å›½éš›ç«¶äº‰åŠ›', color: '#0088FE' },
            { key: 'innovation', name: 'ã‚¤ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³', color: '#00C49F' },
            { key: 'education', name: 'æ•™è‚²åŸºç›¤', color: '#FFBB28' },
            { key: 'policyMaking', name: 'æ”¿ç­–ç«‹æ¡ˆ', color: '#FF8042' },
            { key: 'implementation', name: 'ç¤¾ä¼šå®Ÿè£…åŠ›', color: '#8884d8' },
        ];

        // ã‚³ãƒ›ãƒ¼ãƒˆå®šç¾©ï¼ˆå¹´é½¢å±¤åˆ¥ï¼‰
        const AGE_COHORTS = [
            { key: 'young', name: '22-30æ­³', range: [22, 30], color: '#4ade80' },
            { key: 'midCareer', name: '31-45æ­³', range: [31, 45], color: '#3b82f6' },
            { key: 'senior', name: '46-60æ­³', range: [46, 60], color: '#f59e0b' },
            { key: 'veteran', name: '61-65æ­³', range: [61, 65], color: '#ef4444' },
        ];

        // åˆæœŸäººå£çµ±è¨ˆãƒ‡ãƒ¼ã‚¿ï¼ˆ46ä¸‡äººã‚¹ã‚±ãƒ¼ãƒ«ï¼‰
        const INITIAL_POPULATION = {
            university: { total: 120000, cohorts: { young: 0.8, midCareer: 0.15, senior: 0.05, veteran: 0 } },
            industry: { total: 250000, cohorts: { young: 0.3, midCareer: 0.4, senior: 0.25, veteran: 0.05 } },
            government: { total: 50000, cohorts: { young: 0.2, midCareer: 0.35, senior: 0.35, veteran: 0.1 } },
            research: { total: 40000, cohorts: { young: 0.25, midCareer: 0.4, senior: 0.3, veteran: 0.05 } },
        };

        // åˆæœŸå›½åŠ›çŠ¶æ…‹
        const initialNationalCapability = {
            basicScience: 70,
            appliedTech: 65,
            digitalAI: 55,
            manufacturing: 75,
            finance: 60,
            healthcare: 70,
            energy: 50,
            globalCompete: 45,
            innovation: 50,
            education: 65,
            policyMaking: 55,
            implementation: 60,
        };

        // ç›®æ¨™ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«
        const targetCapability = {
            basicScience: 85,
            appliedTech: 85,
            digitalAI: 90,
            manufacturing: 80,
            finance: 75,
            healthcare: 85,
            energy: 80,
            globalCompete: 75,
            innovation: 85,
            education: 80,
            policyMaking: 70,
            implementation: 80,
        };

        function TalentDevelopmentSimulatorV3() {
            // çŠ¶æ…‹ç®¡ç†
            const [year, setYear] = useState(0);
            const [population, setPopulation] = useState(INITIAL_POPULATION);
            const [capability, setCapability] = useState({...initialNationalCapability});
            const [history, setHistory] = useState([]);
            const [isSimulating, setIsSimulating] = useState(false);
            const [viewMode, setViewMode] = useState('standard'); // 'standard' or 'deviation'
            
            // æ”¿ç­–ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
            const [policyParams, setPolicyParams] = useState({
                universityAdvancement: 56, // å¤§å­¦é€²å­¦ç‡ %
                masterAdvancement: 12,     // ä¿®å£«é€²å­¦ç‡ %
                doctoralAdvancement: 10,   // åšå£«é€²å­¦ç‡ %
                populationDecline: 1.2,    // äººå£æ¸›å°‘ç‡ %/å¹´
                retirementAge: 65,         // é€€è·å¹´é½¢
                techTransferRate: 30,      // æŠ€è¡“ç§»è»¢ç‡ %
            });

            // æŠ•è³‡é…åˆ†
            const [investments, setInvestments] = useState({
                university: 30,
                industry: 35,
                government: 15,
                research: 20,
            });

            // ã‚¹ã‚³ã‚¢è¨ˆç®—
            const calculateScore = useCallback((cap) => {
                const values = Object.values(cap);
                const avg = values.reduce((a, b) => a + b, 0) / values.length;
                const min = Math.min(...values);
                return Math.round(avg * 0.6 + min * 0.4);
            }, []);

            // åå·®å€¤è¨ˆç®—
            const calculateDeviation = useCallback((cap) => {
                const result = {};
                CAPABILITY_AXES.forEach(axis => {
                    // ç›®æ¨™ã‚’åå·®å€¤50ã¨ã—ã¦æ­£è¦åŒ–
                    const target = targetCapability[axis.key];
                    const current = cap[axis.key];
                    result[axis.key] = 50 + (current - target) * 10 / (target * 0.2);
                });
                return result;
            }, []);

            // ã‚³ãƒ›ãƒ¼ãƒˆé–“ã®çŸ¥è­˜ç§»è»¢è¨ˆç®—
            const calculateKnowledgeTransfer = useCallback((pop) => {
                let transferBonus = 0;
                Object.values(pop).forEach(sector => {
                    const cohorts = sector.cohorts;
                    // ã‚·ãƒ‹ã‚¢å±¤ã‹ã‚‰ãƒŸãƒ‰ãƒ«å±¤ã¸ã®çŸ¥è­˜ç§»è»¢
                    const seniorToMid = (cohorts.senior || 0) * (cohorts.midCareer || 0) * 0.1;
                    // ãƒŸãƒ‰ãƒ«å±¤ã‹ã‚‰ãƒ¤ãƒ³ã‚°å±¤ã¸ã®çŸ¥è­˜ç§»è»¢
                    const midToYoung = (cohorts.midCareer || 0) * (cohorts.young || 0) * 0.1;
                    transferBonus += seniorToMid + midToYoung;
                });
                return transferBonus;
            }, []);

            // äººå£å‹•æ…‹ã®æ›´æ–°
            const updatePopulation = useCallback((pop, params) => {
                const newPop = JSON.parse(JSON.stringify(pop));
                
                Object.keys(newPop).forEach(sector => {
                    const sectorPop = newPop[sector];
                    // äººå£æ¸›å°‘ã®å½±éŸ¿
                    sectorPop.total *= (1 - params.populationDecline / 100);
                    
                    // ã‚³ãƒ›ãƒ¼ãƒˆã®å¹´é½¢ã‚·ãƒ•ãƒˆ
                    const oldCohorts = { ...sectorPop.cohorts };
                    sectorPop.cohorts.veteran = oldCohorts.senior * 0.3;
                    sectorPop.cohorts.senior = oldCohorts.midCareer * 0.3 + oldCohorts.senior * 0.7;
                    sectorPop.cohorts.midCareer = oldCohorts.young * 0.3 + oldCohorts.midCareer * 0.7;
                    sectorPop.cohorts.young = oldCohorts.young * 0.7;
                    
                    // é€€è·ã«ã‚ˆã‚‹æ¸›å°‘
                    sectorPop.cohorts.veteran *= 0.8;
                    
                    // æ–°è¦æ¡ç”¨ï¼ˆå¤§å­¦ã‹ã‚‰ï¼‰
                    if (sector === 'university') {
                        sectorPop.cohorts.young += params.universityAdvancement * 1000;
                    }
                });

                return newPop;
            }, []);

            // 1å¹´åˆ†ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
            const simulateYear = useCallback(() => {
                setPopulation(prev => updatePopulation(prev, policyParams));
                
                setCapability(prev => {
                    const newCap = {...prev};
                    
                    // æŠ•è³‡åŠ¹æœã®è¨ˆç®—ï¼ˆäººå£è¦æ¨¡ã‚’è€ƒæ…®ï¼‰
                    Object.entries(investments).forEach(([sector, investment]) => {
                        const sectorPop = population[sector];
                        const popEffect = sectorPop ? sectorPop.total / 100000 : 1;
                        const investEffect = investment / 100 * popEffect;
                        
                        switch(sector) {
                            case 'university':
                                newCap.basicScience += investEffect * 2;
                                newCap.education += investEffect * 1.5;
                                newCap.innovation += investEffect * 1.2;
                                break;
                            case 'industry':
                                newCap.appliedTech += investEffect * 2;
                                newCap.manufacturing += investEffect * 1.8;
                                newCap.digitalAI += investEffect * 1.5;
                                newCap.implementation += investEffect * 1.5;
                                break;
                            case 'government':
                                newCap.policyMaking += investEffect * 2;
                                newCap.finance += investEffect * 1.5;
                                break;
                            case 'research':
                                newCap.globalCompete += investEffect * 2;
                                newCap.healthcare += investEffect * 1.5;
                                newCap.energy += investEffect * 1.5;
                                break;
                        }
                    });

                    // çŸ¥è­˜ç§»è»¢ãƒœãƒ¼ãƒŠã‚¹
                    const transferBonus = calculateKnowledgeTransfer(population);
                    Object.keys(newCap).forEach(key => {
                        newCap[key] += transferBonus;
                    });

                    // é™³è…åŒ–
                    Object.keys(newCap).forEach(key => {
                        const decay = key === 'digitalAI' ? 2 : 1;
                        newCap[key] = Math.max(0, Math.min(100, newCap[key] - decay + Math.random() * 0.5));
                    });

                    return newCap;
                });

                setYear(prev => prev + 1);
            }, [investments, population, policyParams, calculateKnowledgeTransfer]);

            // å±¥æ­´æ›´æ–°
            useEffect(() => {
                const totalPop = Object.values(population).reduce((sum, sector) => sum + sector.total, 0);
                setHistory(prev => [...prev, {
                    year,
                    ...capability,
                    totalScore: calculateScore(capability),
                    population: totalPop,
                    populationByAge: AGE_COHORTS.reduce((acc, cohort) => {
                        acc[cohort.key] = Object.values(population).reduce((sum, sector) => 
                            sum + (sector.cohorts[cohort.key] || 0) * sector.total, 0);
                        return acc;
                    }, {}),
                }]);
            }, [year, capability, population, calculateScore]);

            // è‡ªå‹•ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
            useEffect(() => {
                if (isSimulating && year < 30) {
                    const timer = setTimeout(simulateYear, 800);
                    return () => clearTimeout(timer);
                } else if (year >= 30) {
                    setIsSimulating(false);
                }
            }, [isSimulating, year, simulateYear]);

            // ãƒ‡ãƒ¼ã‚¿å¤‰æ›
            const displayCapability = viewMode === 'deviation' ? calculateDeviation(capability) : capability;
            const displayTarget = viewMode === 'deviation' ? 
                Object.fromEntries(CAPABILITY_AXES.map(axis => [axis.key, 50])) : targetCapability;

            const radarData = CAPABILITY_AXES.map(axis => ({
                axis: axis.name,
                current: displayCapability[axis.key] || 0,
                target: displayTarget[axis.key],
                initial: viewMode === 'deviation' ? 50 : initialNationalCapability[axis.key],
            }));

            // å¹´é½¢æ§‹æˆãƒ‡ãƒ¼ã‚¿
            const ageDistributionData = AGE_COHORTS.map(cohort => {
                const total = Object.values(population).reduce((sum, sector) => 
                    sum + (sector.cohorts[cohort.key] || 0) * sector.total, 0);
                return {
                    name: cohort.name,
                    value: Math.round(total),
                    fill: cohort.color,
                };
            });

            // ã‚»ã‚¯ã‚¿ãƒ¼åˆ¥äººå£ãƒ‡ãƒ¼ã‚¿
            const sectorPopulationData = Object.entries(population).map(([key, sector]) => ({
                name: key === 'university' ? 'å¤§å­¦' : 
                      key === 'industry' ? 'ç”£æ¥­ç•Œ' : 
                      key === 'government' ? 'æ”¿åºœ' : 'ç ”ç©¶æ©Ÿé–¢',
                value: Math.round(sector.total),
                fill: key === 'university' ? '#8b5cf6' : 
                      key === 'industry' ? '#3b82f6' : 
                      key === 'government' ? '#10b981' : '#f59e0b',
            }));

            // ãƒªã‚»ãƒƒãƒˆ
            const resetSimulation = () => {
                setYear(0);
                setPopulation(INITIAL_POPULATION);
                setCapability({...initialNationalCapability});
                setHistory([]);
                setIsSimulating(false);
            };

            return (
                <div className="min-h-screen bg-gray-900 text-white p-4">
                    <h1 className="text-3xl font-bold text-center mb-2 text-cyan-400">
                        ğŸŒ å›½å®¶äººæè‚²æˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ v3
                    </h1>
                    <p className="text-center text-gray-400 mb-4">
                        Large Scale Population Dynamics & Cohort Analysis
                    </p>
                    
                    {/* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼ */}
                    <div className="grid grid-cols-2 md:grid-cols-5 gap-4 mb-6">
                        <div className="bg-gray-800 rounded-lg p-4 text-center">
                            <div className="text-2xl font-bold text-yellow-400">{year}å¹´ç›®</div>
                            <div className="text-gray-400 text-sm">çµŒéå¹´æ•°</div>
                        </div>
                        <div className="bg-gray-800 rounded-lg p-4 text-center">
                            <div className="text-2xl font-bold text-green-400">
                                {(Object.values(population).reduce((sum, s) => sum + s.total, 0) / 1000).toFixed(0)}K
                            </div>
                            <div className="text-gray-400 text-sm">ç·äººææ•°</div>
                        </div>
                        <div className="bg-gray-800 rounded-lg p-4 text-center">
                            <div className="text-2xl font-bold text-blue-400">{calculateScore(capability)}</div>
                            <div className="text-gray-400 text-sm">ç·åˆå›½åŠ›ã‚¹ã‚³ã‚¢</div>
                        </div>
                        <div className="bg-gray-800 rounded-lg p-4 text-center">
                            <div className="text-2xl font-bold text-purple-400">
                                {viewMode === 'deviation' ? 
                                    Object.values(calculateDeviation(capability)).reduce((a,b) => a+b, 0) / CAPABILITY_AXES.length : 
                                    ((Object.values(capability).reduce((a,b) => a+b, 0) / CAPABILITY_AXES.length) / 
                                     (Object.values(targetCapability).reduce((a,b) => a+b, 0) / CAPABILITY_AXES.length) * 100)
                                }.toFixed(1){viewMode === 'deviation' ? '' : '%'}
                            </div>
                            <div className="text-gray-400 text-sm">{viewMode === 'deviation' ? 'å¹³å‡åå·®å€¤' : 'ç›®æ¨™é”æˆåº¦'}</div>
                        </div>
                        <div className="bg-gray-800 rounded-lg p-4 text-center">
                            <button
                                onClick={() => setViewMode(prev => prev === 'standard' ? 'deviation' : 'standard')}
                                className="text-sm bg-gray-700 hover:bg-gray-600 px-3 py-1 rounded transition"
                            >
                                {viewMode === 'standard' ? 'ğŸ“Š åå·®å€¤è¡¨ç¤º' : 'ğŸ“ˆ å®Ÿå€¤è¡¨ç¤º'}
                            </button>
                            <div className="text-gray-400 text-xs mt-1">è¡¨ç¤ºåˆ‡æ›¿</div>
                        </div>
                    </div>

                    {/* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */}
                    <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        
                        {/* å·¦ï¼šãƒ¬ãƒ¼ãƒ€ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ */}
                        <div className="bg-gray-800 rounded-lg p-4">
                            <h2 className="text-xl font-bold mb-4 text-cyan-300">ğŸ“Š å›½åŠ›ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«</h2>
                            <ResponsiveContainer width="100%" height={350}>
                                <RadarChart data={radarData}>
                                    <PolarGrid stroke="#444" />
                                    <PolarAngleAxis dataKey="axis" tick={{ fill: '#aaa', fontSize: 9 }} />
                                    <PolarRadiusAxis angle={30} domain={[0, viewMode === 'deviation' ? 80 : 100]} tick={{ fill: '#666', fontSize: 8 }} />
                                    <Radar name="ç¾åœ¨" dataKey="current" stroke="#00ffff" fill="#00ffff" fillOpacity={0.3} strokeWidth={2} />
                                    <Radar name="ç›®æ¨™" dataKey="target" stroke="#ff6b6b" fill="transparent" strokeDasharray="5 5" />
                                    <Radar name="åˆæœŸ" dataKey="initial" stroke="#888" fill="transparent" strokeDasharray="3 3" />
                                    <Legend wrapperStyle={{ fontSize: '12px' }} />
                                </RadarChart>
                            </ResponsiveContainer>
                        </div>

                        {/* ä¸­ï¼šå¹´é½¢æ§‹æˆ */}
                        <div className="bg-gray-800 rounded-lg p-4">
                            <h2 className="text-xl font-bold mb-4 text-green-300">ğŸ‘¥ å¹´é½¢æ§‹æˆåˆ†æ</h2>
                            <ResponsiveContainer width="100%" height={250}>
                                <BarChart data={ageDistributionData} layout="horizontal">
                                    <CartesianGrid strokeDasharray="3 3" stroke="#444" />
                                    <XAxis type="number" stroke="#888" />
                                    <YAxis type="category" dataKey="name" tick={{ fill: '#aaa', fontSize: 11 }} width={60} />
                                    <Tooltip contentStyle={{ backgroundColor: '#333', border: 'none' }} />
                                    <Bar dataKey="value" />
                                </BarChart>
                            </ResponsiveContainer>
                            <div className="mt-4 text-xs text-gray-400">
                                <p><strong>è‹¥æ‰‹å±¤ä¸è¶³ãƒªã‚¹ã‚¯:</strong> {ageDistributionData[0]?.value < 100000 ? 'âš ï¸ é«˜' : 'âœ… ä½'}</p>
                                <p><strong>æŠ€è¡“ç¶™æ‰¿æ€§:</strong> 
                                    {(ageDistributionData[2]?.value + ageDistributionData[3]?.value) / 
                                     (ageDistributionData[0]?.value + ageDistributionData[1]?.value) > 0.3 ? 'âœ… è‰¯å¥½' : 'âš ï¸ è¦æ³¨æ„'}
                                </p>
                            </div>
                        </div>

                        {/* å³ï¼šã‚»ã‚¯ã‚¿ãƒ¼åˆ¥äººå£ */}
                        <div className="bg-gray-800 rounded-lg p-4">
                            <h2 className="text-xl font-bold mb-4 text-purple-300">ğŸ¢ ã‚»ã‚¯ã‚¿ãƒ¼åˆ¥äººå£</h2>
                            <ResponsiveContainer width="100%" height={250}>
                                <BarChart data={sectorPopulationData}>
                                    <CartesianGrid strokeDasharray="3 3" stroke="#444" />
                                    <XAxis dataKey="name" tick={{ fill: '#aaa', fontSize: 10 }} />
                                    <YAxis stroke="#888" />
                                    <Tooltip contentStyle={{ backgroundColor: '#333', border: 'none' }} />
                                    <Bar dataKey="value" />
                                </BarChart>
                            </ResponsiveContainer>
                            <div className="mt-4 text-xs text-gray-400">
                                <p><strong>ç”£å­¦æ¯”ç‡:</strong> {(population.industry.total / population.university.total).toFixed(1)}:1</p>
                                <p><strong>ç ”ç©¶é›†ç´„åº¦:</strong> {((population.research.total + population.university.total) / 
                                    Object.values(population).reduce((sum, s) => sum + s.total, 0) * 100).toFixed(1)}%</p>
                            </div>
                        </div>
                    </div>

                    {/* æ”¿ç­–ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ */}
                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6">
                        
                        {/* æ”¿ç­–è¨­å®š */}
                        <div className="bg-gray-800 rounded-lg p-4">
                            <h2 className="text-xl font-bold mb-4 text-orange-300">âš™ï¸ æ”¿ç­–ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿</h2>
                            {[
                                { key: 'universityAdvancement', name: 'ğŸ“ å¤§å­¦é€²å­¦ç‡', unit: '%', range: [40, 80] },
                                { key: 'masterAdvancement', name: 'ğŸ“š ä¿®å£«é€²å­¦ç‡', unit: '%', range: [5, 25] },
                                { key: 'doctoralAdvancement', name: 'ğŸ¯ åšå£«é€²å­¦ç‡', unit: '%', range: [3, 20] },
                                { key: 'populationDecline', name: 'ğŸ“‰ äººå£æ¸›å°‘ç‡', unit: '%/å¹´', range: [0.5, 3] },
                                { key: 'retirementAge', name: 'ğŸ‘´ é€€è·å¹´é½¢', unit: 'æ­³', range: [60, 70] },
                                { key: 'techTransferRate', name: 'ğŸ”„ æŠ€è¡“ç§»è»¢ç‡', unit: '%', range: [10, 50] },
                            ].map(param => (
                                <div key={param.key} className="mb-3">
                                    <div className="flex justify-between items-center mb-1">
                                        <span className="text-sm">{param.name}</span>
                                        <span className="text-yellow-400 font-bold">{policyParams[param.key]}{param.unit}</span>
                                    </div>
                                    <input
                                        type="range"
                                        min={param.range[0]}
                                        max={param.range[1]}
                                        step={param.key === 'populationDecline' ? 0.1 : 1}
                                        value={policyParams[param.key]}
                                        onChange={(e) => setPolicyParams(prev => ({
                                            ...prev, 
                                            [param.key]: parseFloat(e.target.value)
                                        }))}
                                        className="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer"
                                    />
                                </div>
                            ))}
                        </div>

                        {/* æŠ•è³‡é…åˆ† */}
                        <div className="bg-gray-800 rounded-lg p-4">
                            <h2 className="text-xl font-bold mb-4 text-green-300">ğŸ’° æŠ•è³‡é…åˆ†</h2>
                            {[
                                { key: 'university', icon: 'ğŸ“', name: 'å¤§å­¦ãƒ»ç ”ç©¶', desc: 'åŸºç¤ç ”ç©¶ãƒ»äººæè‚²æˆ' },
                                { key: 'industry', icon: 'ğŸ­', name: 'ç”£æ¥­ç•Œ', desc: 'å®Ÿè·µæŠ€è¡“ãƒ»ã‚¤ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³' },
                                { key: 'government', icon: 'ğŸ›ï¸', name: 'æ”¿åºœ', desc: 'æ”¿ç­–ç«‹æ¡ˆãƒ»åˆ¶åº¦è¨­è¨ˆ' },
                                { key: 'research', icon: 'ğŸ”¬', name: 'å¤–éƒ¨ç ”ç©¶', desc: 'å…ˆç«¯æŠ€è¡“ãƒ»å›½éš›é€£æº' },
                            ].map(sector => (
                                <div key={sector.key} className="mb-4">
                                    <div className="flex justify-between items-center mb-1">
                                        <span className="text-sm">{sector.icon} {sector.name}</span>
                                        <span className="text-yellow-400 font-bold">{investments[sector.key]}%</span>
                                    </div>
                                    <input
                                        type="range"
                                        min="0"
                                        max="100"
                                        value={investments[sector.key]}
                                        onChange={(e) => setInvestments(prev => ({
                                            ...prev, 
                                            [sector.key]: parseInt(e.target.value)
                                        }))}
                                        className="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer"
                                    />
                                    <p className="text-gray-500 text-xs mt-1">{sector.desc}</p>
                                </div>
                            ))}
                            <div className="text-right mt-4">
                                <span className={`font-bold ${Object.values(investments).reduce((a,b) => a+b, 0) === 100 ? 'text-green-400' : 'text-red-400'}`}>
                                    åˆè¨ˆ: {Object.values(investments).reduce((a,b) => a+b, 0)}%
                                </span>
                            </div>
                        </div>
                    </div>

                    {/* æ™‚ç³»åˆ—ã‚°ãƒ©ãƒ• */}
                    <div className="bg-gray-800 rounded-lg p-4 mt-6">
                        <h2 className="text-xl font-bold mb-4 text-yellow-300">ğŸ“ˆ é•·æœŸãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æ</h2>
                        <ResponsiveContainer width="100%" height={300}>
                            <LineChart data={history}>
                                <CartesianGrid strokeDasharray="3 3" stroke="#444" />
                                <XAxis dataKey="year" stroke="#888" />
                                <YAxis domain={[0, viewMode === 'deviation' ? 80 : 100]} stroke="#888" />
                                <Tooltip 
                                    contentStyle={{ backgroundColor: '#333', border: 'none' }}
                                    labelStyle={{ color: '#fff' }}
                                />
                                <Legend />
                                <Line type="monotone" dataKey="totalScore" stroke="#00ffff" strokeWidth={3} name="ç·åˆã‚¹ã‚³ã‚¢" dot={false} />
                                <Line type="monotone" dataKey="basicScience" stroke="#8884d8" strokeWidth={1} name="åŸºç¤ç§‘å­¦" dot={false} />
                                <Line type="monotone" dataKey="digitalAI" stroke="#ffc658" strokeWidth={1} name="ãƒ‡ã‚¸ã‚¿ãƒ«ãƒ»AI" dot={false} />
                                <Line type="monotone" dataKey="innovation" stroke="#82ca9d" strokeWidth={1} name="ã‚¤ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³" dot={false} />
                            </LineChart>
                        </ResponsiveContainer>
                    </div>

                    {/* äººå£æ¨ç§» */}
                    <div className="bg-gray-800 rounded-lg p-4 mt-6">
                        <h2 className="text-xl font-bold mb-4 text-red-300">ğŸ‘¥ äººå£å‹•æ…‹æ¨ç§»</h2>
                        <ResponsiveContainer width="100%" height={250}>
                            <AreaChart data={history}>
                                <CartesianGrid strokeDasharray="3 3" stroke="#444" />
                                <XAxis dataKey="year" stroke="#888" />
                                <YAxis stroke="#888" />
                                <Tooltip contentStyle={{ backgroundColor: '#333', border: 'none' }} />
                                <Area type="monotone" dataKey="population" stroke="#ff6b6b" fill="#ff6b6b" fillOpacity={0.3} name="ç·äººå£" />
                            </AreaChart>
                        </ResponsiveContainer>
                        <div className="grid grid-cols-4 gap-4 mt-4 text-xs">
                            {AGE_COHORTS.map(cohort => (
                                <div key={cohort.key} className="text-center">
                                    <div style={{ color: cohort.color }} className="font-bold">
                                        {cohort.name}
                                    </div>
                                    <div className="text-gray-400">
                                        {history.length > 0 ? 
                                            Math.round(history[history.length - 1].populationByAge?.[cohort.key] / 1000) : 0}Käºº
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>

                    {/* ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒœã‚¿ãƒ³ */}
                    <div className="flex justify-center gap-4 mt-6 mb-8">
                        <button
                            onClick={simulateYear}
                            disabled={isSimulating}
                            className="px-6 py-3 bg-blue-600 hover:bg-blue-700 rounded-lg font-bold transition disabled:opacity-50"
                        >
                            â–¶ï¸ 1å¹´é€²ã‚ã‚‹
                        </button>
                        <button
                            onClick={() => setIsSimulating(!isSimulating)}
                            className={`px-6 py-3 rounded-lg font-bold transition ${isSimulating ? 'bg-red-600 hover:bg-red-700' : 'bg-green-600 hover:bg-green-700'}`}
                        >
                            {isSimulating ? 'â¸ï¸ åœæ­¢' : 'â© è‡ªå‹•ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³'}
                        </button>
                        <button
                            onClick={resetSimulation}
                            className="px-6 py-3 bg-gray-600 hover:bg-gray-700 rounded-lg font-bold transition"
                        >
                            ğŸ”„ ãƒªã‚»ãƒƒãƒˆ
                        </button>
                    </div>

                    {/* åˆ†æã‚µãƒãƒªãƒ¼ */}
                    <div className="bg-gray-800 rounded-lg p-4 mt-6">
                        <h2 className="text-xl font-bold mb-4 text-cyan-300">ğŸ“Š åˆ†æã‚µãƒãƒªãƒ¼</h2>
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
                            <div>
                                <h3 className="font-bold text-white mb-2">ğŸ¯ äººææˆ¦ç•¥</h3>
                                <p className="text-gray-300">
                                    ç¾åœ¨ã®è¨­å®šã§ã¯ã€{year}å¹´é–“ã§ç·äººå£ã¯{' '}
                                    {history.length > 0 ? 
                                        ((Object.values(INITIAL_POPULATION).reduce((sum, s) => sum + s.total, 0) - 
                                          Object.values(population).reduce((sum, s) => sum + s.total, 0)) / 
                                         Object.values(INITIAL_POPULATION).reduce((sum, s) => sum + s.total, 0) * 100).toFixed(1) : 0
                                    }%æ¸›å°‘ã€‚
                                </p>
                            </div>
                            <div>
                                <h3 className="font-bold text-white mb-2">âš¡ æŠ€è¡“é©æ–°åº¦</h3>
                                <p className="text-gray-300">
                                    ãƒ‡ã‚¸ã‚¿ãƒ«ãƒ»AIèƒ½åŠ›: {capability.digitalAI.toFixed(1)} 
                                    (ç›®æ¨™æ¯”: {(capability.digitalAI / targetCapability.digitalAI * 100).toFixed(0)}%)
                                </p>
                            </div>
                            <div>
                                <h3 className="font-bold text-white mb-2">ğŸ”® å°†æ¥äºˆæ¸¬</h3>
                                <p className="text-gray-300">
                                    ç¾åœ¨ã®ãƒšãƒ¼ã‚¹ã§ã¯ç›®æ¨™é”æˆã¾ã§{' '}
                                    {Math.max(0, Math.ceil((100 - Object.values(capability).reduce((a,b) => a+b, 0) / CAPABILITY_AXES.length) / 2))}å¹´å¿…è¦ã€‚
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<TalentDevelopmentSimulatorV3 />, document.getElementById('root'));
    </script>
</body>
</html>